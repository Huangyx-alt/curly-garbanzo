---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/5/17 18:54
---

local CardEffectSupplement = {}
local this = CardEffectSupplement
local GetShakeName = nil
local PlayGiftShake = nil
local gameType = nil

function CardEffectSupplement:Init(cardView)
    gameType = ModelList.BattleModel:GetGameType()
    this.cardView = cardView
    if ModelList.BattleModel:GetGameType() ~= PLAY_TYPE.PLAY_TYPE_AUTO_TICKET then
        GetShakeName = this.GetNormalShakeName
        PlayGiftShake = this.PlayNormalGiftShake
    else
        GetShakeName = this.GetHangUpShakeName
        PlayGiftShake = this.PlayHangUpGiftShake
    end
end

local GetNormalShakeName =  function (effectType)
    return effectType == 2 and "bingo" or "pick"
end

local GetHangUpShakeName = function (effectType)
    return effectType == 2 and "bingo" or "pick_guaji"
end

function CardEffectSupplement.GetShakeName(effectType)
    if gameType ~= PLAY_TYPE.PLAY_TYPE_AUTO_TICKET then
        return GetNormalShakeName(effectType)
    else
        return GetHangUpShakeName(effectType)
    end
    return GetNormalShakeName(effectType)
end




local MapPlayGiftShakeByBingo  = function(mapIndex)
    mapIndex = tonumber(mapIndex)
    local animaObj = fun.find_child( this.cardView:GetCardMap(mapIndex),"b_letter")
    local ani = fun.get_component(animaObj, fun.ANIMATOR)
    ani:Play("gift_bingo",-1,0)
end


---@see  触发bingo,其他卡牌震屏效果
local OtherCardShake = function(currMapIndex)
    for k,v in pairs(this.cardView:GetCardMap()) do
        if v:GetCardObj() ~= currMapIndex then
            if this.cardView:IsCardShowing(k) then
                MapPlayGiftShakeByBingo(k)
            end
        end
    end
end

---@see 战斗背景震屏效果
local BgShake = function(anim,animName)
    if anim then anim:Play(animName,-1,0) end
end


---@see  卡牌获取道具的震屏效果
local PlayNormalGiftShake = function(ani,aniName,mapIndex,bgAnim)
    ani:SetTrigger("gift")
    ani:ResetTrigger("bingo")
    ani:Play(aniName, -1, 0)
    OtherCardShake(mapIndex)
    BgShake(bgAnim, "Bg_act")
end

---@see  挂机卡牌获取道具的震屏效果
local PlayHangUpGiftShake = function (ani,aniName,mapIndex,bgAnim)
    ani:ResetTrigger("bingo")
    ani:Play(aniName, -1, 0)
    BgShake(bgAnim, "Bg_gift_guaji")
end

function CardEffectSupplement:PlaylGiftShake(ani,aniName,mapIndex,bgAnim)
    if gameType ~= PLAY_TYPE.PLAY_TYPE_AUTO_TICKET then
        PlayNormalGiftShake(ani,aniName,mapIndex,bgAnim)
    else
        PlayHangUpGiftShake(ani,aniName,mapIndex,bgAnim)
    end
end



function CardEffectSupplement:PlaylBingoShake(ani,aniName,mapIndex,bgAnim)
    ani:SetTrigger("bingo")
    ani:ResetTrigger("gift")
    ani:Play(aniName,-1,0)
    OtherCardShake(mapIndex)
    BgShake(bgAnim,"Bg_act_bingo")
end




return this