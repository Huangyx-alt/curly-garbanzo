---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2024/4/9 16:30
---

local BaseOrder = require "PopupOrder/BaseOrder"
local PopupOrder = Clazz(BaseOrder,"")
local this = PopupOrder

function PopupOrder.Execute()
    Event.AddListener(EventName.Event_show_halloffame_score_view,this.Finish)
    
    local isActivityAvailable = ModelList.HallofFameModel:IsActivityAvailable()
    if not isActivityAvailable then
        this.Finish()
        return
    end
    
    if this.CheckLvOpen() then
        if ModelList.HallofFameModel:CheckHasStateAward() then
            local oldScore,oldTier = ModelList.HallofFameModel:GetStateAwardScore();
            local tier = ModelList.HallofFameModel:GetTiers()
            local isUpTier = nil;
            if oldTier ~= nil then
                isUpTier = oldTier ~= tier;
            end
            ViewList.HallofFameScoreView:DisablebVictoryShopBtn()
            Facade.SendNotification(NotifyName.ShowUI, ViewList.HallofFameScoreView,nil,false,
                    {isUpTier = isUpTier,oldScore = oldScore,lastWeekTier = oldTier})
        else
            this.Finish()
        end
    else
        this.Finish()
    end
end

function PopupOrder.Finish()
    Event.RemoveListener(EventName.Event_show_halloffame_score_view,PopupOrder.Finish)
    log.g("brocast  EventName.Event_popup_order_finish ")
    Event.Brocast(EventName.Event_popup_order_finish,true)
end

function PopupOrder.CheckLvOpen()
    local openLevel = ModelList.HallofFameModel:GetUnlockLv()
    local myLevel = ModelList.PlayerInfoModel:GetLevel()

    return myLevel >= openLevel
end

return PopupOrder