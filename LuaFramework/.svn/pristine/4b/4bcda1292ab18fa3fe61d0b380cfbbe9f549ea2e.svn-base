-----
----- Generated by EmmyLua(https://github.com/EmmyLua)
----- Created by PC.
----- DateTime: 2022/2/17 16:31
-----
--
-----
----- Generated by EmmyLua(https://github.com/EmmyLua)
----- Created by PC.
----- DateTime: 2022/2/17 16:31
-----
--
--
--FoodBagClaimShowState = Clazz(BaseFsmState, "FoodBagClaimShowState")
--local this = FoodBagClaimShowState
--local allNum = 0
--local objNum = 0
--local IsDouble = false
--
--function FoodBagClaimShowState:OnEnter(fsm, previous, view, data)
--    --local view, data = select(1,...)
--    this.fsm = fsm
--    this.view = view
--    IsDouble = data.double == 1 or false
--    this:RefreshFoodBagClaimView(view, data)
--end
--
--local function DoubleWithNumTxt(value)
--    if IsDouble then
--        return value / 2
--    end
--    return value
--end
--
--local function PlayByItemCount(data, view, objNum)
--    local currNum = 0
--    local obj = view["itemParent"]
--    this.waitActiveList = {}
--    for i = 1, #data.boxes do
--        for m = 1, #data.boxes[i].resourceInfo do
--            currNum = currNum + 1
--            local child = fun.find_child(obj, tostring(currNum))
--            local sp = fun.get_component(child, fun.IMAGE)
--            local iconName = Csv.GetData("resources", data.boxes[i].resourceInfo[m].id, "big_icon")
--            sp.sprite = AtlasManager:GetSpriteByName("ItemAtlas", iconName)
--            local countObj = fun.find_child(sp.gameObject, "count")
--            local countTxt = fun.get_component(countObj, "Text")
--            countTxt.text = "x" .. DoubleWithNumTxt(data.boxes[i].resourceInfo[m].value)
--            local countObj = fun.find_child(sp.gameObject, "materialName")
--            local countTxt = fun.get_component(countObj, "Text")
--            local name = Csv.GetData("resources", data.boxes[i].resourceInfo[m].id, "name")
--            countTxt.text = name
--            table.insert(this.waitActiveList, child)
--        end
--        for m = 1, #data.boxes[i].itemInfo do
--            currNum = currNum + 1
--            local child = fun.find_child(obj, tostring(currNum))
--            local sp = fun.get_component(child, fun.IMAGE)
--            local iconName = Csv.GetData("item", data.boxes[i].itemInfo[m].id, "icon")
--            ViewTool:LoadFoodSprite(iconName, iconName, sp)
--            local countObj = fun.find_child(sp.gameObject, "count")
--            local countTxt = fun.get_component(countObj, "Text")
--            countTxt.text = "x" .. DoubleWithNumTxt(data.boxes[i].itemInfo[m].value)
--            local countObj = fun.find_child(sp.gameObject, "materialName")
--            local countTxt = fun.get_component(countObj, "Text")
--            local desId = Csv.GetData("item", data.boxes[i].itemInfo[m].id, "name_description")
--            local name = Csv.GetData("description", desId, "description")
--            countTxt.text = name
--            local level = Csv.GetData("item", data.boxes[i].itemInfo[m].id, "level")
--            local levelGo = fun.find_child(sp.gameObject, "mGmakeGjBz")
--            fun.set_active(levelGo.transform,((level or 0) > 0 and {true} or {false})[1])
--            table.insert(this.waitActiveList, child)
--        end
--    end
--    ---等待一会图片资源加载
--    LuaTimer:SetDelayFunction(0.3, function()
--        if this.waitActiveList and #this.waitActiveList > 0 then
--            for i = 1, #this.waitActiveList do
--                fun.set_active(this.waitActiveList[i], true)
--            end
--        end
--        --this.waitActiveList =nil
--        this:PlayOpen(view)
--        view.bagAnima:Play("open" .. objNum)
--    end)
--end
--
--function FoodBagClaimShowState:RefreshFoodBagClaimView(view, data)
--    allNum = 0
--    objNum = 0
--    for i = 1, #data.boxes do
--        allNum = allNum + #data.boxes[i].resourceInfo + #data.boxes[i].itemInfo
--    end
--    if allNum <= 12 or allNum == 15 then
--        objNum = allNum
--    else
--        objNum = 20
--    end
--    --local obj = view["item"..objNum]
--    --if obj == nil  then log.r("没有对应的物体") end
--
--    PlayByItemCount(data, view, objNum)
--
--
--    --fun.set_active(view.bagCount.gameObject,false)
--    --UISound.play("food_bagopen")
--    this.update_x_enabled = true
--    this:start_x_update()
--    --UISound.play("food_bagopen")
--end
--
--function FoodBagClaimShowState:GetFoodBagCount()
--    local foodBags = ModelList.CityModel:GetCityFoodBag()
--    local count = 0
--    for i = 1, #foodBags do
--        for k, v in pairs(foodBags) do
--            if v.value > 0 then
--                count = count + v.value
--            end
--        end
--    end
--    return count
--end
--
--function FoodBagClaimShowState:PlayOpen(view)
--    local foodBags = view.bagCount
--    if foodBags >= 1 and foodBags <= 4 then
--        view.view:Play("pen0" .. foodBags)
--        LuaTimer:SetDelayLoopFunction(0.1, 0.5, foodBags, function()
--            UISound.play("food_bagopen")
--        end)
--    elseif foodBags > 4 then
--        view.view:Play("pen05_12")
--        UISound.play("food_bagopen_1")
--    end
--end
--
--function FoodBagClaimShowState:CheckDouble()
--
--end
--
--function FoodBagClaimShowState:on_x_update()
--    if this.update_x_enabled then
--        if this.view.bagAnima:GetCurrentAnimatorStateInfo(0) .normalizedTime > 0.95 and
--                this.view.bagAnima:GetCurrentAnimatorStateInfo(0):IsName("open" .. objNum) then
--            if IsDouble then
--                this:PlayChangeNum()
--            else
--                this:SetNextState()
--            end
--        end
--    end
--end
--
--function FoodBagClaimShowState:SetNextState()
--    this:stop_x_update()
--    LuaTimer:SetDelayFunction(0.2, function()
--        this.fsm:ChangeState("FoodBagClaimFlyItemState", allNum)
--    end)
--end
--
--local function ReomveStr(str, remove)
--    local lcSubStrTab = {}
--    while true do
--        local lcPos = string.find(str, remove)
--        if not lcPos then
--            lcSubStrTab[#lcSubStrTab + 1] = str
--            break
--        end
--        local lcSubStr = string.sub(str, 1, lcPos - 1)
--        lcSubStrTab[#lcSubStrTab + 1] = lcSubStr
--        str = string.sub(str, lcPos + 1, #str)
--    end
--    local lcMergeStr = ""
--    local lci = 1
--    while true do
--        if lcSubStrTab[lci] then
--            lcMergeStr = lcMergeStr .. lcSubStrTab[lci]
--            lci = lci + 1
--        else
--            break
--        end
--    end
--    return lcMergeStr
--end
--
--function FoodBagClaimShowState:PlayChangeNum()
--    this.view:PlayFoodNumDouble()
--    this.update_x_enabled = false
--    IsDouble = false
--    for i = 1, #this.waitActiveList do
--        if this.waitActiveList[i] then
--            local txtObj = fun.find_child(this.waitActiveList[i], "count")
--            local txt = fun.get_component(txtObj, "Text")
--            local oriNum = tonumber(ReomveStr(txt.text, "x"))
--            if oriNum then
--                txt.text = "x" .. (oriNum * 2)
--            end
--        end
--    end
--    LuaTimer:SetDelayFunction(0.5, function()
--        --this.update_x_enabled = true
--        this:SetNextState()
--    end)
--end
--
--function FoodBagClaimShowState:FlyItems()
--    --local obj = this.view["item"..objNum]
--    local obj = this.view["itemParent"]
--    local delay = 0
--    for i = 1, allNum do
--        local flyObj = fun.find_child(obj, tostring(i))
--        if flyObj then
--            local path = {}
--            local start_position = flyObj.transform.position
--            local endPos = GetFunctionPosition("FunctionIconCuisinesView")
--            path[1] = fun.calc_new_position_between(start_position, endPos, 0.45, 1, 0)
--            path[2] = endPos
--            local scale = MCT.FoodBagClaimScale
--            Anim.scale_to_xy(flyObj, scale, scale, MCT.FoodBagClaimToIcon)
--            Anim.bezier_move(flyObj, path, MCT.FoodBagClaimToIcon, delay, 1, 2, function()
--                local view = GetFunctionView("FunctionIconCuisinesView")
--                local anima = fun.get_component(view, fun.ANIMATOR)
--                HomeEffectCache:GetPrefabFromCache("DaojubaodianGet", view, false, function(obj)
--                    fun.set_gameobject_scale(obj, 0.4, 0.4, 1)
--                end, 1)
--                if anima then
--                    anima:Play("Get")
--                end
--                fun.set_active(flyObj.gameObject, false)
--                UISound.play("task_item_increase")
--                if i == allNum then
--                    this.view:SetData()
--                end
--            end)
--            delay = delay + 0.1
--        end
--    end
--end
--
--function FoodBagClaimShowState:OnLeave(fsm)
--end
--
--
--
--
--
