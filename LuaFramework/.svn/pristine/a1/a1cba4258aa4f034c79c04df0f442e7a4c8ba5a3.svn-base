---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2023/12/5 9:57
---
--- �³���Ԥ�浯��

local BaseOrder = require "PopupOrder/BaseOrder"
local PopupOrder = Clazz(BaseOrder,"")
local this = PopupOrder

function PopupOrder.Execute(args,orderData)
    --this.Finish()

    --local openLevel = Csv.GetControlByName("newcity_open_level")[1][1]
    --if ModelList.PlayerInfoModel:GetLevel() >= openLevel then
    --    local lastData =  fun.read_value("NewCityComingSoonView",0)
    --    local today = os.date("%Y%m%d", os.time())
    --
    --    if lastData ~= today then
    --        Event.AddListener(EventName.Event_popup_new_city_coming_finish,this.Finish)
    --        local view = require("View/Popup/NewCityComingSoonView"):New()
    --        Facade.SendNotification(NotifyName.ShowUI, view)
    --    else
    --        this.Finish()
    --    end
    --else
    --    this.Finish()
    --end

    ---换成周年庆活动逻辑
    local anniversaryInfo = ModelList.FixedActivityModel:GetAnniversaryInfo()
    local openLevel = Csv.GetControlByName("newcity_open_level")[1][1]
    if ModelList.PlayerInfoModel:GetLevel() >= openLevel and anniversaryInfo and anniversaryInfo.isAnniversaryActive then
        local lastData =  fun.read_value("AnniversaryComingView",0)
        local today = os.date("%Y%m%d", os.time())

        if lastData ~= today then
            Event.AddListener(EventName.Event_popup_new_city_coming_finish,this.Finish)
            local view = require("View/Popup/AnniversaryComingView"):New()
            Facade.SendNotification(NotifyName.ShowUI, view)
        else
            this.Finish()
        end
    else
        this.Finish()
    end
end

function PopupOrder.Finish()
    log.g("brocast  EventName.Event_popup_new_city_coming_finish ")
    Event.RemoveListener(EventName.Event_popup_new_city_coming_finish,this.Finish)
    this.NotifyCurrentOrderFinish()
end

---

return this