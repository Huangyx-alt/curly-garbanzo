---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/6/29 18:40
---


local ApplicationGuideInfo = require("Guide.ApplicationGuide.ApplicationGuideInfo")
--- 战斗中pu待使用1秒后未点击时
---@class  GamePowerUpViewGuide : ApplicationGuideInfo
local GamePowerUpViewGuide = ApplicationGuideInfo:New()
local this = GamePowerUpViewGuide

function GamePowerUpViewGuide:Init()
    if not ModelList.GuideModel:IsForceBattle() then
        this:Register()
        this.model = ModelList.BattleModel:GetCurrModel()
        this.view = ModelList.BattleModel:GetCurrBattleView()
    end
end

function GamePowerUpViewGuide:Remove()
    this:UnRegister()
    this:PlayFingerEffect(nil,true,nil,true)
end

local function IsNeedGuidePower()
    return not this.view.powerView:IsAuto() and this.view.powerView:IsEnoughCharge()
end

function GamePowerUpViewGuide:RecharegeOver(isCharge)
    if isCharge then
        this.delay_show = LuaTimer:SetDelayFunction(this.data[1].delay_time,function()
            log.r("powerup  show finger")
            if IsNeedGuidePower() then
                this:PlayFingerEffect(this.view.powerView.cd_img, false, this.data[1])
            end
            this.delay_show = nil
        end)
    else
        this:PlayFingerEffect(nil,true)
        if this.delay_show then
            LuaTimer:Remove(this.delay_show)
            this.delay_show = nil
        end
    end
end

function this:Register()
    Event.AddListener(EventName.ApplicationGuide_PowerUp,this.RecharegeOver)
end


function this:UnRegister()
    Event.RemoveListener(EventName.ApplicationGuide_PowerUp,this.RecharegeOver)
end

return this