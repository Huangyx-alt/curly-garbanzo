---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/3/4 17:23
---

require("Combat.Machine.BattleMachineConfig")

BattleMachineList = {
    CallNumberMachine =  require 'Combat.Machine.CallNumber.CallNumberMachine',
    CalculateBingoMachine = require("Combat/Machine/CalculateBingoMachine"),
    BingoLeftTickMachine = require("Combat/Machine/BingoLeftTickMachine"),
    BingoOrderMachine = require("Combat/Machine/BingoOrderMachine"),
    RecorderMachine  = require("Combat.Replay.RecorderMachine"),
    HangUpCallNumberMachine  = require("Combat.Machine.CallNumber.HangUpCallNumberMachine"),
    HeartMachine   = require("Combat.Machine.HeartMachine"),
    BingoJokerMachine   = require("Combat.Machine.BingoJokerMachine"),
}

GMMachineList = {
    RecorderMachine  = require("Combat.Replay.RecorderMachine"),
}

local this = BattleMachineList
this.MachineState = 0

this.MachineEnabled = false

local GetBattleTypeStr = function()
    local gameType = ModelList.BattleModel:GetGameType()
    if gameType ~= PLAY_TYPE.PLAY_TYPE_AUTO_TICKET then
         return "PLAY_TYPE_NORMAL"
    else
        return "PLAY_TYPE_AUTO_TICKET"
    end
end

function BattleMachineList.StartBattleMachine()
    this.MachineState = 1
    local model = ModelList.BattleModel:GetCurrModel()
    local loadData = model:LoadGameData()
    local typeStr = GetBattleTypeStr()
    for k, v in pairs(BattleMachineList) do
        if type(v) ~= "function" and BattleMachineConfig[typeStr][k] and
                BattleMachineConfig[typeStr][k] == 1 then
            v:set_machine_open(loadData)
            v:Start(loadData)
            if v.Register then v.Register() end
        end
    end
    this.StarBattleGMMachine()
    this.MachineEnabled = true
end

function BattleMachineList.StopBattleMachine()
    this.MachineState = 3
    local typeStr = GetBattleTypeStr()
    for k, v in pairs(BattleMachineList) do
        if type(v) ~= "function"  and type(v)~= "boolean"  and
                BattleMachineConfig[typeStr][k] then
            v:Stop()
            if v.UnRegister then v.UnRegister() end
        end
    end
   -- UnityEngine.Time.timeScale = 1
    this.MachineEnabled = false
end

function BattleMachineList.PauseBattleMachine(isPause)
    this.MachineState = 2
    log.r("PauseBattleMachine  "..tostring(isPause))
    for k, v in pairs(BattleMachineList) do
        if type(v) == "table" and v.Pause ~= nil  then
            v:Pause(isPause)
        end
    end
end

---获取状态机的状态  1激活  2暂停  3 停止
function BattleMachineList.GetMachieState()
 return    this.MachineState

end

function BattleMachineList.StarBattleGMMachine()
    local typeStr = GetBattleTypeStr()
    for k, v in pairs(GMMachineList) do
        if type(v) ~= "function" and GMMachineConfig[typeStr][k] and
                GMMachineConfig[typeStr][k] == 1 then
            v:Start()
            if v.Register then v.Register() end
        end
    end
    this.MachineEnabled = true
end

function BattleMachineList.StopBattleGMMachine()
    local typeStr = GetBattleTypeStr()
    for k, v in pairs(GMMachineList) do
        if type(v) ~= "function"  and type(v)~= "boolean" and GMMachineConfig[typeStr][k] and
                GMMachineConfig[typeStr][k] == 1 then
            v:Stop()
            if v.UnRegister then v.UnRegister() end
        end
    end
end

function BattleMachineList.GetMchine(machineName)
    for k, v in pairs(BattleMachineList) do
        if type(v) == "table" and v.machineName == machineName  then
            return v
        end
    end
    return nil
end

