---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/8/11 10:32
---固定开启的活动
local FixedActivityModel = BaseModel:New("FixedActivityModel")
local this = FixedActivityModel


function FixedActivityModel:SetLoginData(data)
    if data and data.normalActivity then
        --七日签到活动状态数据
        this.sevenSignState = data.normalActivity.sevenSignState
        --this.sevenSignState.hasHistoryReward = 1
        --登录奖励可领取状态
        this.dailyReward = data.normalActivity.dailyReward
        -- 周榜奖励状态数据
        this.weekRankState = data.normalActivity.weekRankState
        this.dailyRewardType = data.normalActivity.dailyRewardType
        --- 周年庆活动
        this.Anniversary ={isAnniversaryActive = data.isAnniversaryActive , anniversaryCloseTime = data.anniversaryCloseTime,anniversaryStartTime = data.anniversaryStartTime}
    end
end


function FixedActivityModel:GetSevenDayLoginData()
    return this.sevenSignState
end

---7天登陆签到有未领取的历史奖励
local function HasSevenDayLoginHistoryReward()
    return this.sevenSignState.hasHistoryReward == 1
end

--- 是否有7天登陆奖励
function FixedActivityModel:HaveSevenDayReward()
    if this.sevenSignState then
        if HasSevenDayLoginHistoryReward() then return true end
        if this.sevenSignState.sevenSignList then
            for i = 1, #this.sevenSignState.sevenSignList do
                if this.sevenSignState.sevenSignList[i].status == 1 then
                    return true
                end
            end
        end
        if this.sevenSignState.sevenSignProgressList then
            for i = 1, #this.sevenSignState.sevenSignProgressList do
                if this.sevenSignState.sevenSignProgressList[i].status == 1 and
                        this.sevenSignState.sevenSignProgressList[i].target <= this.sevenSignState. sevenSignProgress then
                    return true
                end
            end
        end
    end
end

--- 7天奖励类型
function FixedActivityModel:SetRewardViewBoxType(boxType)
    this.rewardViewBoxType =  boxType
end

function FixedActivityModel:GetRewardViewBoxType()
    return this.rewardViewBoxType
end

---七日签到领奖
------默认值0-七日活动全部进度奖励+全部签到奖励，1-全部签到奖励，2-全部进度奖励，3-单个签到奖励，4-单个进度奖励
function FixedActivityModel.Req_SEVENSIGN_RECEIVE_REWARD(rewardType ,index)
    this.SendMessage(MSG_ID.MSG_SEVENSIGN_RECEIVE_REWARD, {type = rewardType,index = index});
end

---七日签到领奖
function FixedActivityModel.Res_SEVENSIGN_RECEIVE_REWARD(code,data)
    if code  == RET.RET_SUCCESS then
        if data.type == -1 then

        else
            Facade.SendNotification(NotifyName.ClaimReward.PopupClaimReward,PopupViewType.show,ClaimRewardViewType.sevenDayReward,data.reward,function()
                Facade.SendNotification(NotifyName.ClaimReward.PopupClaimReward, PopupViewType.hide, ClaimRewardViewType.sevenDayReward)
                --Event.Brocast(EventName.Event_currency_change)
                ViewList.SevenDayLoginView:ShowReward()
            end,true,ClaimRewardAnimation.sevenDayLogin)
        end
    else
        ViewList.SevenDayLoginView:TryExit()
    end
end

---七日签到状态数据后端推送
function FixedActivityModel.Res_SEVENSIGN_NOTIFY(code,data)
    if code  == RET.RET_SUCCESS then
        this.sevenSignState = data.state
    end
end









-------------------------------------双倍美食活动-----------------------------------

function FixedActivityModel:IsDoubleIngredirnts()
    return true
end

function FixedActivityModel:SetDoubleIngredirnts()

end







-------------------------------------双倍饼干活动-----------------------------------

function FixedActivityModel:IsDoubleCookies()
    return false
end

function FixedActivityModel:SetDoubleIngredirnts()

end









-------------------------------------双倍拼图活动-----------------------------------

function FixedActivityModel:IsDoublePuzzles()
    return false
end

function FixedActivityModel:SetDoubleIngredirnts()

end


function FixedActivityModel:GetDailyRewardType()
    return this.dailyRewardType
end

-------------------------------------周年庆活动region-----------------------------------
function FixedActivityModel:GetAnniversaryInfo()
    if this.Anniversary then
        local curTime = ModelList.PlayerInfoModel.get_cur_server_time()
        this.Anniversary.isAnniversaryActive =  (curTime < this.Anniversary.anniversaryCloseTime and
                curTime>= this.Anniversary.anniversaryStartTime) and true  or false
        return this.Anniversary
    end
    return {isAnniversaryActive = false}
end
--- 是否正在周年庆活动
function FixedActivityModel:IsAnniversary()
    if this.Anniversary then
        local curTime = ModelList.PlayerInfoModel.get_cur_server_time()
        this.Anniversary.isAnniversaryActive =  (curTime < this.Anniversary.anniversaryCloseTime and
                curTime>= this.Anniversary.anniversaryStartTime) and true  or false
        return this.Anniversary.isAnniversaryActive
    end
    return false
end
-------------------------------------周年庆活动endregion-----------------------------------


this.MsgIdList =
{
    {msgid = MSG_ID.MSG_SEVENSIGN_RECEIVE_REWARD, func = this.Res_SEVENSIGN_RECEIVE_REWARD},
    {msgid = MSG_ID.MSG_SEVENSIGN_NOTIFY, func = this.Res_SEVENSIGN_NOTIFY}
}

return this