---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2025/2/10 15:11
---
local SGExtraBallDataCmp = {}
local this = SGExtraBallDataCmp


function SGExtraBallDataCmp:Init()
    self:RegEvent()
end


function SGExtraBallDataCmp:RegEvent()
    if(self.MsgIdList )then
        for k1, v1 in ipairs(self.MsgIdList) do
            if v1.msgid then Message.AddMessage(v1.msgid, v1.func) end
        end
    end
end

function SGExtraBallDataCmp:UnRegEvent()
    if(self.MsgIdList )then
        for k1, v1 in ipairs(self.MsgIdList) do
            if v1.msgid then Message.RemoveMessage(v1.msgid) end
        end
    end
end

--刮刮乐玩法，收到摇球机数据
function SGExtraBallDataCmp.ResponeBallShaker(code, data)
    if (code == RET.RET_SUCCESS) then
        this:SaveScratchBallShakerData(data)
        Event.Brocast(EventName.Event_Receive_SmallGame_Data,true)
    else
        Event.Brocast(EventName.Event_Receive_SmallGame_Data,false)
    end
end

--刮刮乐玩法，返回摇奖结果
function SGExtraBallDataCmp.ResponeBallShakerResult(code, data)
    --附带其它-推送协议
    table.each(data and data.nextMessages, function(v)
        local body = Base64.decode(v.msgBase64)
        local ret = Proto.decode(v.msgId, body)
        ret.noResponeNotify = true
        Message.DispatchMessage(v.msgId, v.code, ret)
    end)

    if (code == RET.RET_SUCCESS) then
        if ViewList.SGExtraBallMainView then
            ViewList.SGExtraBallMainView:ShowExtraBall(data.index)
        end
        this.BallShakerResult = data
    elseif code == RET.RET_GAME_NOT_EXIST then
        if BingoBangEntry.IsReplayBattle then
            if ViewList.SGExtraBallMainView then
                ViewList.SGExtraBallMainView:ReplayShowExtraBall()
            end
        else
            ---游戏不存在,主动拉取一次游戏结算数据
            ModelList.BattleModel:GetCurrModel().ReqFetchSettle()
        end
    end
end


--刮刮乐玩法，入场清除ScratchBallShakerData
function SGExtraBallDataCmp:ClearData()
    this.ShakerData = nil
    self:UnRegEvent()
end

function SGExtraBallDataCmp:SaveScratchBallShakerData(data)
    self.ShakerData = data
end

--刮刮乐玩法，收到摇球机数据
function SGExtraBallDataCmp:GetSmallGameData()
    return this.ShakerData
end

--刮刮乐玩法，收到摇球机数据
function SGExtraBallDataCmp:GetSmallGameData2()
    return nil
end

--获取其他数据的接口
function SGExtraBallDataCmp:GetExtraSmallGameData()
    return this.BallShakerResult and this.BallShakerResult.totalWin or 0
end

---新的小游戏可以把协议放在这里,摇球器用的旧的
--this.MsgIdList = {
--    { msgid = MSG_ID.MSG_GAME_BALL_SHAKER_INFO, func = this.ResponeBallShaker },
--    { msgid = MSG_ID.MSG_GAME_BALL_SHAKER_USE, func = this.ResponeBallShakerResult },
--}

return SGExtraBallDataCmp
