---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zlc.
--- DateTime: 2020/7/10 18:00
---
---@see 弹窗的基类
---@class BaseDialogView : BaseView
BaseDialogView = BaseView:New('BaseDialogView')
BaseDialogView.viewType = CanvasSortingOrderManager.LayerType.Machine_Dialog
BaseDialogView.isFullDialog = false  --是否全屏(全屏在大厅时,会播放大厅效果)
local this = BaseDialogView;
this.__index = this;

this.can_back_key_press_close = true
this.is_has_hide_action = true
this.is_skip_show = false
local showDeltaTime = ArtConfig.Show_DialogView_Time
local hideDeltaTime = ArtConfig.Hide_DialogView_Time

function BaseDialogView:New(viewName, atlasName,bundleName)
    return setmetatable({viewName = viewName,atlasName = atlasName, bundleName = bundleName, isShow = false, isLoaded = false}, this);
end

---SkipLoadShowUI方式显示要传两个参数go,is_no_has_animation
---ShowUI方式显示只需要传一个参数is_no_has_animation
function BaseDialogView:ShowDialog(go,callback,is_click)  --显示弹窗

    if self.is_skip_show then
        Facade.SendNotification(NotifyName.SkipLoadShowUI, self, go,is_click)
    else
        --Facade.SendNotification(NotifyName.ShowUI, self, callback,is_click)
        Facade.SendNotification(NotifyName.ShowPopup, self, callback,is_click)
    end

    -- if is_no_has_animation == false then
        -- self:TweenShow()
    -- end

    SceneViewManager.AddPage(self)
end


function BaseDialogView:on_after_bind_ref()
    -- if  self.is_tween_show then

        self:TweenShow()


        -- self.is_tween_show = false
    -- end
end


function BaseDialogView:HideDialog(is_click)  --关闭弹窗
    if(self.delayShowStart)then 
        LuaTimer:Remove(self.delayShowStart)
    end
    local closeFunc = function ()
        if self.is_skip_show then
            Facade.SendNotification(NotifyName.HideUI, self,is_click)
        else
            Facade.SendNotification(NotifyName.CloseUI, self,is_click)
        end
    end

    if  this.is_has_hide_action == false or is_no_has_animation == true then
        closeFunc()
    else
        self:TweenHide()
        self:register_invoke(function()
            closeFunc()
        end, 0.2)
    end
    SceneViewManager.PopPage()



    --Facade.SendNotification(NotifyName.AdPopus.CloseAdPopusDialog,self.viewName)
end

function BaseDialogView:TweenShow() --播放显示动画
        --log.r("TweenShow")
        local ani = fun.get_component(self.go,fun.ANIMATOR)

    if(self.isFullDialog)then
        Facade.SendNotification(NotifyName.LobbyCommand.PlayLobbyEffect,false)
        self:register_invoke(function ()
            -- if(not fun.is_null(ani))then
            --     ani:Play("start")   --延时播放动画,防止前面几帧看不到
            -- end
            self:PlayViewAni("start")
        end,0.2)
    else
        if(not fun.is_null(ani))then
            self:PlayViewAni("start")  --延时播放动画,防止前面几帧看不到
        end
    end
    self:PlayShowAudio()
end


function BaseDialogView:PlayViewAni(aniName)
    local ani = fun.get_component(self.go,fun.ANIMATOR)
    if(not fun.is_null(ani))then
        ani:Play(aniName)   --延时播放动画,防止前面几帧看不到
    end
end


function BaseDialogView:TweenHide()  --隐藏动画
 
    -- local ani = fun.get_component(self.go,fun.ANIMATOR)
    -- if(not fun.is_null(ani))then 
    --     -- ani:Play("end")
      
    -- end
    self:PlayViewAni("end")
    if(self.isFullDialog)then 
        Facade.SendNotification(NotifyName.LobbyCommand.PlayLobbyEffect,true)
    end
    
end


function BaseDialogView:PlayShowAudio()
    --UISound.play("common_popup")
end






