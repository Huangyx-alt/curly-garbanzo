---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2024/2/20 17:53
---

local AnniversaryComingView = BaseView:New('AnniversaryComingView',"AnniversaryComingAtlas");

local this = AnniversaryComingView

function AnniversaryComingView:New(view)
    local o = {};
    setmetatable(o, { __index = this })
    o.view = view
    return o
end


this.auto_bind_ui_items = {
    "btn_play",
    "time",
    "Content",
}

function AnniversaryComingView:Awake(obj, obj2)
    self:on_init()
end

function AnniversaryComingView:OnEnable()
    self:SaveToday()
    local anniversaryInfo = ModelList.FixedActivityModel:GetAnniversaryInfo()
    if anniversaryInfo then
        local curr = ModelList.PlayerInfoModel.get_cur_server_time()
        self.endTime = anniversaryInfo.anniversaryCloseTime
        self.time.text =  fun.SecondToStrFormat( self.endTime - curr)

        self.loopTime = self:register_loop_timer(0, 1, -1, function()
            if self then
                local curr = ModelList.PlayerInfoModel.get_cur_server_time()
                self.time.text =  fun.SecondToStrFormat( self.endTime - curr)
                local leftTime = self.endTime -curr
                if leftTime <0   then
                    if self.loopTime then
                        LuaTimer:Remove(self.loopTime,LuaTimer.TimerType.UI)
                    end
                end
            end
        end,nil,nil,LuaTimer.TimerType.UI)
    end
    self.Content.text = Csv.GetDescription(30119)
end

function AnniversaryComingView:OnDisable()
    if self.loopTime then
        LuaTimer:Remove(self.loopTime,LuaTimer.TimerType.UI)
    end
    Event.Brocast(EventName.Event_popup_new_city_coming_finish)
end

function AnniversaryComingView:OnDestroy()
    if self.loopTime then
        LuaTimer:Remove(self.loopTime,LuaTimer.TimerType.UI)
    end
end

function AnniversaryComingView:on_btn_close_click()
    --Facade.SendNotification(NotifyName.CloseUI,self)
    self:closeWithAnimation()
end


function AnniversaryComingView:on_btn_play_click()
    --Facade.SendNotification(NotifyName.CloseUI,self)
    self:closeWithAnimation()
end



function AnniversaryComingView:SaveToday()
    local today = os.date("%Y%m%d", os.time())
    fun.save_value("AnniversaryComingView",today)
end

function AnniversaryComingView:_close()
    Facade.SendNotification(NotifyName.CloseUI,self)
    self.__index:_close(self)
end

return this 