---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2024/1/8 17:57
---

local WinZoneInPropgressView = BaseView:New("WinZoneInPropgressView","WinZoneInProgressInMainAtlas")

local this = WinZoneInPropgressView
this.isCleanRes = true
this._cleanImmediately = true
this.viewType = CanvasSortingOrderManager.LayerType.TopConsole
this.auto_bind_ui_items = {
    "btn_confirm",
    "btn_no"
}

function WinZoneInPropgressView:New()
    local o = {}
    self.__index = self
    setmetatable(o,self)
    return o
end

function WinZoneInPropgressView:Awake()
    self:on_init()
    this._view = self
end


function WinZoneInPropgressView:OnEnable()
    Facade.RegisterView(self)
end


function WinZoneInPropgressView:Check_WinZone_Need_Open()
    if ModelList.WinZoneModel:IsActivityValid() and ModelList.WinZoneModel:ShouldGotoGameHall() then
        return true
    end
    return false
end


function WinZoneInPropgressView:on_btn_confirm_click()
    if self:Check_WinZone_Need_Open() then
        if  ModelList.WinZoneModel:CheckVersion() then
            ModelList.WinZoneModel:EnterGameHall()
        end
    end
    Facade.SendNotification(NotifyName.CloseUI,self)
end


function WinZoneInPropgressView:on_btn_no_click()
    --Facade.SendNotification(NotifyName.CloseUI,self)
    ModelList.WinZoneModel:C2S_VictoryBeatsExit()
end

function WinZoneInPropgressView:OnClaimReward(bundle)
    if bundle then
        if bundle.code == RET.RET_SUCCESS and fun.is_table_empty(bundle.reward)  then
            ModelList.WinZoneModel:DisplayReward(bundle.data.reward, nil)
            Facade.SendNotification(NotifyName.CloseUI,self)
        else
            Facade.SendNotification(NotifyName.CloseUI,self)
        end
    end
end

function WinZoneInPropgressView:OnDisable()
    if this._view then
        Facade.RemoveView(this._view)
    end
end


function WinZoneInPropgressView.OnClaimExit(bundle)
    if bundle and bundle.reward and #bundle.reward > 0 then
        ModelList.WinZoneModel:DisplayReward(bundle.reward, nil)
    end
    Facade.SendNotification(NotifyName.CloseUI,this._view)
end


this.NotifyList =
{
    --{notifyName = NotifyName.WinZone.ReadyPlaySucc, func = this.OnReadyPlaySucc},
    --{notifyName = NotifyName.WinZone.ReadyPlayFail, func = this.OnReadyPlayFail}
    {notifyName = NotifyName.WinZone.ClaimReward, func = this.OnClaimReward},
    {notifyName = NotifyName.WinZone.Exit, func = this.OnClaimExit},
}

return this



