---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/7/15 12:29
---

---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2021/9/7 14:47
---

local PopupModel = BaseModel:New("PopupModel")
local this = PopupModel
this.ViewCache = nil

local PopMapping = {}

local PopupType = {Global = 1,GlobalNet = 2, CommonPop = 3 , CommonError = 4}


function PopupModel:AddPopMap(view,popupType)
    if not PopMapping[popupType]  or PopMapping[popupType] == nil then
         PopMapping[popupType] = view
    elseif PopMapping[popupType] and PopMapping[popupType] ~= view then
        log.y("已经有一个现成弹窗,先清理")
        Facade.SendNotification(NotifyName.HideDialog,  PopMapping[popupType] )
        PopMapping[popupType] = view
    end
end

function PopupModel:RemovePopMap(view)
    for k,v in pairs(PopMapping) do
        if v == view then
            PopMapping[k]  = nil
            break
        end
    end
end


function PopupModel:AddPopupView(view,popupType)
    if  this.ViewCache == nil then  this.ViewCache = {} end
    if not fun.is_include(view,this.ViewCache) then
        table.insert(this.ViewCache,view)
    end
    this:AddPopMap(view,popupType)
end

function PopupModel:RemovePopupView(view)
    for i = 1, #this.ViewCache do
        if this.ViewCache[i] == view then
            table.remove(this.ViewCache,i)
            break
        end
    end
    this:RemovePopMap(view)
end

function PopupModel:RemoveAllPopup()
    if this.ViewCache then
        for i = #this.ViewCache, 1,-1 do
            if this.ViewCache[i] then
                if this.ViewCache[i].on_btn_close_click then
                    this.ViewCache[i]:on_btn_close_click()
                else
                    this.ViewCache[i]:Close()
                end
            end
        end
		this.ViewCache = {}
    end
    PopMapping = {}
    --Facade.SendNotification(NotifyName.HideDialog,)
end


return this