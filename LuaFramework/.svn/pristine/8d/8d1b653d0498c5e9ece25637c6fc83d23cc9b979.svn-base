---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/3/30 15:00
---

require("View.Bingo.EffectPool.BattleEffectCache")
require("View.Bingo.EffectPool.BattleEffectPreload")

---@class EffectObjContainer : BaseChildView
local EffectObjContainer = BaseChildView:New();
local this = EffectObjContainer;
EffectObjContainer.__index = EffectObjContainer

this.auto_bind_ui_items = {

}

function EffectObjContainer:Init(obj)
    self:on_init(obj)
    self:CacheChild()
    self:CreateEffect()
    self:InitLayer()
end

function EffectObjContainer:CacheChild()
    fun.eachChild(self.go, function(child)
        local childName = child.name
        self[childName] = child
    end)
end

function EffectObjContainer:InitLayer()
    if self.go then
        local canvas = fun.get_component(self.go,fun.CANVAS)
        if canvas then
            local parent = ModelList.BattleModel:GetCurrBattleView()
            canvas.sortingOrder = (parent:IsAuto() and {15} or {4})[1]
        end
    end
end

function EffectObjContainer:CreateEffect()
    BattleEffectCache:CreateBattleEffect(self)
    BattleEffectPreload:CreateBattleEffect(self)
end

function EffectObjContainer:PreLoadBattleRes(cb)
    BattleEffectPool:CreateBattleEffect(self, cb)
end

function EffectObjContainer:OnDestroy()
    BattleEffectPool:Release()
    BattleEffectCache:Release()
    BattleEffectPreload:Release()
end

function EffectObjContainer:OnDisable()
    --BattleEffectPool:Release()
    --BattleEffectCache:Release()
    --BattleEffectPreload:Release()
    self:Close()
end

function EffectObjContainer:ReadyForRocketView(ParentObj)
    if self.go then
        fun.set_parent(self.go, ParentObj, true)
        CanvasSortingOrderManager.SetLayerOrder(CanvasSortingOrderManager.LayerType.Machine_Dialog, self.go)
        --if ViewList.GameSettleView.go then
        --    local canvas1 = fun.get_component(ViewList.GameSettleView.go, fun.CANVAS)
        --    local canvas2 = fun.get_component(this.go, fun.CANVAS)
        --    if canvas1.sortingOrder > canvas2.sortingOrder then
        --        log.r("canvas sortOrder  " .. canvas1.sortingOrder .. "    " .. canvas2.sortingOrder)
        --    end
        --end
    else
        log.r("ReadyForRocketView fail")
    end
end

function EffectObjContainer:ReadyForOtherView(ParentObj)
    if self.go then
        fun.set_parent(self.go, ParentObj, true)
        fun.set_sorting_order_relative(self.go,10)
        --CanvasSortingOrderManager.SetLayerOrder(CanvasSortingOrderManager.LayerType.Machine_Dialog, self.go)
        --if ViewList.GameSettleView.go then
        --    local canvas1 = fun.get_component(ViewList.GameSettleView.go, fun.CANVAS)
        --    local canvas2 = fun.get_component(this.go, fun.CANVAS)
        --    if canvas1.sortingOrder > canvas2.sortingOrder then
        --        log.r("canvas sortOrder  " .. canvas1.sortingOrder .. "    " .. canvas2.sortingOrder)
        --    end
        --end
    else
        log.r("ReadyForRocketView fail")
    end
end

function EffectObjContainer:ShowGetG(obj,bingoView)
    this:on_init(obj)
end

function  EffectObjContainer:IsSkillContainerEmpty()
    if not  BattleModuleList.GetModule("CardPower"):IsSkillEffectComplete() then
        return false
    end

    if fun.get_child_count(this.SkillContainer) == 0 then return true end
    local count = fun.get_child_count(this.SkillContainer)
    for i = 0, count-1 do
        local obj = fun.get_child(this.SkillContainer,i)
        if obj and fun.get_active_self(obj) then
            return false
        end
    end
    return true
end

function EffectObjContainer:New(name)
    local o = {name = name}
    setmetatable(o,{__index = EffectObjContainer })
    return o
end

function EffectObjContainer:GetSkillContainer()
    return this.SkillContainer
end

return this


