---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/7/9 15:53
---


TaskTipCheckProgressState = Clazz(BaseFsmState,"TaskTipCheckProgressState")


function TaskTipCheckProgressState:OnEnter(fsm,previous)
    local lastData = ModelList.TaskModel.GetDailyTask()
    local submitData = {}
    for i = 1, #lastData do
        if lastData[i].process == lastData[i].target and not lastData[i].rewarded  then
            local taskItemCache = fsm:GetOwner():GetTaskItem()
            for k = 1, #taskItemCache do
                local taskData = taskItemCache[k]:GetTaskData()
                if taskData.taskId == lastData[i].taskId then
                    taskItemCache[k]:PlayFullEffect()
                    break
                end
            end
            table.insert(submitData,{taskType = lastData[i].taskType,taskGroup =lastData[i].taskGroup,
                                     taskId =   lastData[i].taskId,createTime = lastData[i].createTime})
        end
    end
    lastData = ModelList.TaskModel.GetWeeklyTask()
    for i = 1, #lastData do
        if lastData[i].process == lastData[i].target and not lastData[i].rewarded  then
            local taskItemCache = fsm:GetOwner():GetTaskItem()
            for i = 1, #taskItemCache do
                local taskData = taskItemCache[i]:GetTaskData()
                if taskData.taskId == lastData[i].taskId then
                    taskItemCache[i]:PlayFullEffect()
                    break
                end
            end
            table.insert(submitData,{taskType = lastData[i].taskType,taskGroup =lastData[i].taskGroup,
                                     taskId =   lastData[i].taskId,createTime = lastData[i].createTime})
        end
    end

    if #submitData > 0 then
        ModelList.TaskModel.C2S_SubmitTask(submitData)
    end
    TaskTipCheckProgressState:ChcekFull(fsm)
end
TaskTipCheckProgressState.delayTimer = nil
function TaskTipCheckProgressState:ChcekFull(fsm)
    TaskTipCheckProgressState.delayTimer = LuaTimer:SetDelayFunction(0.5,function()
        if fsm then
            self:ChangeState(fsm,"TaskTipExitState")
        end
        TaskTipCheckProgressState.delayTimer = nil
    end)
end

function TaskTipCheckProgressState:PlayGrow(fsm)

end

function TaskTipCheckProgressState:Finish(fsm)
end
function TaskTipCheckProgressState:Dispose()
    if TaskTipCheckProgressState.delayTimer then
        LuaTimer:Remove(TaskTipCheckProgressState.delayTimer)
        TaskTipCheckProgressState.delayTimer = nil
    end
end

