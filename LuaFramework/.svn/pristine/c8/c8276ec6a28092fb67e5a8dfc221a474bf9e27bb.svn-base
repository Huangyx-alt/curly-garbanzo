---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2023/4/21 12:07
---

local CompetitionCookieReadyView = BaseView:New("CompetitionCookieReadyView","CompetitionCookieAtlas")
local this = CompetitionCookieReadyView
this.viewType = CanvasSortingOrderManager.LayerType.TopConsole

local remainTimeCountDown = RemainTimeCountDown:New()

function CompetitionCookieReadyView:New()
    local o = {}
    self.__index = this
    setmetatable(o,this)
    return o
end

this.auto_bind_ui_items = {
    "Clock",
    "selfItem",
    "otherItem",
    "text_countdown",
    "Content",
}


function CompetitionCookieReadyView:Awake(obj)
    self:on_init()
end

function CompetitionCookieReadyView:OnEnable(params)
    self:LoadRanks()
    self:InitTimer()
    self:OnTimerCall()
    fun.set_rect_local_pos_y(self.go,0)
end

function CompetitionCookieReadyView:OnDisable()
    remainTimeCountDown:StopCountDown()
    if self._timer then
        self._timer:Stop()
    end
end


function CompetitionCookieReadyView:InitTimer()
    if self._timer then
        self._timer:Stop()
    end
    self._timer = Timer.New(function()
        self:OnTimerCall()
    end,1,-1,true)
    self._timer:Start()
end

function CompetitionCookieReadyView:OnTimerCall()
    self:SetClock()
end

function CompetitionCookieReadyView:SetClock()
    remainTimeCountDown:StartCountDown(CountDownType.cdt1,
            ModelList.CompetitionModel:GetRemainTime(),
            self.text_countdown,
            function()
            end)
end

local rankItemList ={}
function CompetitionCookieReadyView:LoadRanks()
    local rankInfoList = ModelList.BattleModel:GetCurrModel():GetBattleCompetitionGameInfo("rank")
    local myUid = (ModelList.PlayerInfoModel:GetUid())
    rankItemList = {}
    local readyItem = require("View.DailyCompetition.CompetitionCookieReadyRankItem")
    if rankInfoList and #rankInfoList >0 then
        for i = 1, #rankInfoList  do
            --log.g("rankd  "..i.."       "..#rankInfoList)
            if myUid == rankInfoList[i].uid then
                local view = readyItem:New(false)
                fun.set_active(self.selfItem,true)
                view:SkipLoadShow(self.selfItem.gameObject)
                table.insert(rankItemList,view)
            else
                local view = readyItem:New(false)
                local  go = fun.get_instance(self.otherItem,self.otherItem.transform.parent)
                view:SkipLoadShow(go.gameObject)
                fun.set_active(go,true)
                table.insert(rankItemList,view)
            end
            rankItemList[i]:SetRankData(rankInfoList[i],i)
            --rankItemList[i]:SetLayerIndex(layerIndex)
            --layerIndex = layerIndex + 1
        end
        self.Content.sizeDelta= Vector2.New(195*#rankInfoList+100, 221.9)
    end
end

return this