---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2021/10/19 17:36
---

local GameQuitView = BaseDialogView:New('CommonPopupView',"PopupAtlas")
local this = GameQuitView
this.viewType = CanvasSortingOrderManager.LayerType.Popup_Dialog

this.auto_bind_ui_items = {
    "btn_sure",
    "btn_cancle",
    "content",
    "title",
    "btn_close"
}

this.sure_cb = nil
this.cancel_cb = nil

--params @oktype  0:普通双按钮  1: 普通单按钮    2: 错误双按钮  3: 错误单按钮
function GameQuitView:SetInfo()
    self.title:SetNativeSize()
    local content = Csv.GetData("description", 8001, "description")
    self.title.sprite = AtlasManager:GetSpriteByName("BingoBangPopupAtlas", "TYAYS")
    self.title:SetNativeSize()
    self.content.text = content
    self:SetBtnType()
    --self.sure_cb = this.SureEvent
    --self.cancel_cb = cancel_cb
end

function GameQuitView.SureEvent()
    if BingoBangEntry.IsInBattlePreSettle then
        return
    end
    
    ModelList.BattleModel.SetQuitBattle(true)
    local CmdStartBattleSettle = require "Logic.Command.Battle.Settle.CmdStartBattleSettle"
    local cmd = CmdStartBattleSettle.New()
    cmd:Execute()
end

function GameQuitView:SetBtnType()
    fun.set_active(self.btn_cancle, true)
    --local pos = fun.get_gameobject_pos(self.btn_sure, true)
    --fun.set_gameobject_pos(self.btn_sure, 0, pos.y, pos.z, true)
end

function GameQuitView.Awake(obj)
    --this.update_x_enabled = true

    --this:on_init()
    this:SetInfo()
end

function GameQuitView.OnEnable()
    this.update_x_enabled = true
    this:start_x_update()
    Event.Brocast(Notes.CARD_COLLIDER_OPEN,false)
end

function GameQuitView:on_x_update()
    --this:CheckInputClick()
end


function GameQuitView.OnDisable()
    this:stop_x_update()
    Event.Brocast(Notes.CARD_COLLIDER_OPEN,true)
end


function GameQuitView.OnDestroy()
    this:Destroy()
end

function GameQuitView:on_close()
    this:stop_x_update()
    Event.Brocast(Notes.CARD_COLLIDER_OPEN,true)
end

function GameQuitView:CloseFunc()
    Facade.SendNotification(NotifyName.HideUI, self)
end


function GameQuitView:ShowTip(tipName)
end

function GameQuitView:InitTip()
end

function GameQuitView:CutDonwTarget()
    this:CloseFunc()
    this.main_effect:Play("end")
end

local last_click_time = 0
function GameQuitView:on_btn_sure_click()
    if self.go then log.r(self.go.name) end
    --if self.sure_cb then
    --    self.sure_cb()
    --end
    this.SureEvent()
    Facade.SendNotification(NotifyName.HideUI, self)
    --Event.Brocast(EventName.Event_Joker_Hide_First_Joker)
    last_click_time = UnityEngine.Time.time
end

function GameQuitView:on_btn_cancle_click()
    if self.cancel_cb then    self.cancel_cb()  end
    Facade.SendNotification(NotifyName.HideUI, self)
    last_click_time = UnityEngine.Time.time
end


function GameQuitView:on_btn_close_click()
    if self.cancel_cb then    self.cancel_cb()  end
    Facade.SendNotification(NotifyName.HideUI, self)
end


function GameQuitView.NewPop(view_type)
    --如果o为false或者o为nil，则让o为{}
    comonPopup = comonPopup or {viewName ="GameQuitView",atlasName = "PopupAtlas", viewType = view_type}

    setmetatable(comonPopup,{__index = this})
    if comonPopup.go ~= nil then log.e ("NewPop   not nil ") end
    return comonPopup
end

function GameQuitView:New()
    local o = o or {viewName ="GameQuitView",atlasName = "PopupAtlas",isShow = false, isLoaded = false}
    return setmetatable(o, {__index = this});
end

return this





