---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2021/9/1 18:13
---
local PowerUpBaseState = require "State.PowerUpView.PowerUpBaseState"
local PowerUpPrimitiveState = Clazz(PowerUpBaseState,"PowerUpPrimitiveState")

local isShake = true

function PowerUpPrimitiveState:OnLeave(fsm)
    self:Dispose()
end

function PowerUpPrimitiveState:Dispose()
    self:StopTimer()
    self._fsm = nil
end

function PowerUpPrimitiveState:StopTimer()
    if self._timer then
        self._timer:Stop()
        self._timer = nil
    end
end

function PowerUpPrimitiveState:OnEnter(fsm)
    if isShake then
        local page = ModelList.CityModel:GetMaxPage()
        if page == 0 then
            self._fsm = fsm
            self:StopTimer()
            self._timer = Timer.New(function()
                self:OnTimerCall()
            end,5,-1)
            self._timer:Start()
        end
    end
end

function PowerUpPrimitiveState:OnTimerCall()
    self._fsm:GetOwner():PlayEpicShake()
end

--在此状态如果收到网络消息，就查询下卡牌
function PowerUpPrimitiveState:DrawCard(fsm)
    ModelList.CityModel.C2S_FetchPowerUp()
end

function PowerUpPrimitiveState:EnterPowerUp(fsm)
    if fsm then
        self:ChangeState(fsm,"PowerUpEnterState")
    end
end
--是否发消息
function PowerUpPrimitiveState:ClickDrawCard(fsm,gear,args,flag)
    if fsm then
        isShake = false
        self:ChangeState(fsm,"PowerUpClickState",args,gear,flag)
    end
end

function PowerUpPrimitiveState:TurnPage(fsm,dir,args)
    if fsm then
        self:ChangeState(fsm,"PowerUpClickState",args,dir)
    end
end

function PowerUpPrimitiveState:Play(fsm,args)
    if fsm then
        self:ChangeState(fsm,"PowerUpClickState",args)
    end
end

function PowerUpPrimitiveState:CloseView(fsm,args)
    if fsm then
        isShake = true
        self:ChangeState(fsm,"PowerUpClickState",args)
    end
end

function PowerUpPrimitiveState:ShowPowerupHelper(fsm)
    if fsm then
        fsm:GetOwner():OnShowPowerupHelper()
    end
end

function PowerUpPrimitiveState:CurrencyBuyClick(fsm,cb)
    if fsm then
        fsm:GetOwner():onCurrencyBuyClick(cb)
    end
end

return PowerUpPrimitiveState