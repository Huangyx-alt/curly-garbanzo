---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/4/9 18:26
---



local ClimbRankJackpotState = Clazz(BaseFsmState, "ClimbRankJackpotState")
local this = ClimbRankJackpotState

local RewardType = {Jackpot = 1}

function ClimbRankJackpotState:New()
    local o = {}
    setmetatable(o, { __index = ClimbRankJackpotState })
    return o
end

function ClimbRankJackpotState:InitState()
end

local baseSettleReward = nil
local addCound = 0
local cardCount = 0

function ClimbRankJackpotState:OnEnter(fsm, previous )
    local settleData = ModelList.BattleModel:GetCurrModel():GetSettleData().groupSettleReward
    baseSettleReward = settleData.jackpotSettleReward
    addCound = 0
    cardCount = #fsm:GetOwner():GetCards()
    this._fsm = fsm
    this:PlayJackpot(fsm)
end

local GetCoinItemCount = function(gift)
    local count = 0
    for i = 1, #gift do
        if gift[i] == 1005 or gift[1] == 1006 or gift[1] == 1007 then
            count = count +1
        end
    end
    return count
end


---@see 展示点击金币奖励
local GetRefundCoin = function(cardId)
    local data = ModelList.BattleModel:GetCurrModel():GetRoundData(cardId)
    local itemCount = 0
    if data.isJackpot then
        itemCount = 1
    end
    --itemCount = 1
    this._fsm:GetOwner():SetAddReward(cardId, 9,itemCount )
end



local GetRewardContent = function(cardId,rewardType)
    if rewardType == RewardType.Jackpot then
        GetRefundCoin(cardId)
    end
end



function ClimbRankJackpotState:PlayJackpot(fsm )
    if #baseSettleReward.jackpot > 0 and baseSettleReward.jackpot[1].value > 0 then
        for i = 1, cardCount do
            GetRewardContent(i,RewardType.Jackpot,fsm)
        end
        addCound  = baseSettleReward.jackpot[1].value
        fsm:GetOwner():SetAddCountTxt(addCound)
        local PlayNext = function()
            this:PalyEnd()
        end
        fsm:GetOwner():PlayRewardJump(PlayNext)
    else
        this:PalyEnd()
    end
end




function ClimbRankJackpotState:PalyEnd( )
    self:ChangeState(this._fsm,"ClimbRankTeammateAwardState")
    if addCound <= 0 then

    else

    end
end


function ClimbRankJackpotState:Finish()

end


function ClimbRankJackpotState:OnLeave(fsm)
    this._fsm = nil
    self._owner = nil
    self._posX = nil
end

function ClimbRankJackpotState:Dispose()
    self:OnLeave(nil)
end

return this