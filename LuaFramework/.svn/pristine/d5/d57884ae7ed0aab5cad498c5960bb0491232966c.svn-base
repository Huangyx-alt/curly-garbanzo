---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2023/4/24 16:06
---

local CompetitionDependentFile = {}

function CompetitionDependentFile:GetDenpendentInfo()
    --if ModelList.CompetitionModel:IsActivityAvailable() then
    --    local data = ModelList.CompetitionModel:GetActivityInfo()
    --    if data and data.competitionStartId and CompetitionDependentFile[data.competitionStartId] then
    --        return CompetitionDependentFile[data.competitionStartId]
    --    end
    --else
    if ModelList.VolcanoMissionModel:IsStartActivity() then
        return CompetitionDependentFile[5]
    elseif ModelList.CarQuestModel:IsActivityAvailable() then
        return CompetitionDependentFile[4]
    else
        local data = ModelList.CompetitionModel:GetActivityInfo()
        if data and data.competitionStartId and CompetitionDependentFile[data.competitionStartId] then
            return CompetitionDependentFile[data.competitionStartId]
        end
    end
end

function CompetitionDependentFile:GetCompetitionRankData()
    --if ModelList.CompetitionModel:IsActivityAvailable() then
    --    local data = ModelList.BattleModel:GetCurrModel():GetBattleCompetitionGameInfo("rank")
    --    return data
    --else
        if ModelList.CarQuestModel:IsActivityAvailable() then
        local data = ModelList.CarQuestModel:GetRankData()
        return data
    end
end

function CompetitionDependentFile:GetCompetitionView()
    local data = ModelList.CompetitionModel:GetActivityInfo()
    --local id = data and data.competitionStartId or 1
    local info = CompetitionDependentFile[1]
    local viewPath = info.topCompetitionView
    return require(viewPath)
    --if ModelList.CompetitionModel:IsActivityAvailable() then
    --    local data = ModelList.CompetitionModel:GetActivityInfo()
    --    local id = data and data.competitionStartId or 1
    --    local info = CompetitionDependentFile[id]
    --    local viewPath = info.topCompetitionView
    --    return require(viewPath)
    --else
    --    if ModelList.CarQuestModel:IsActivityAvailable() then
    --        local info = CompetitionDependentFile[4]
    --        local viewPath = info.topCompetitionView
    --    return require(viewPath)
    --end
end

---展示Cookie的入场效果
---@param obj table 实例化的effct OBj
function CompetitionDependentFile.ShowCookieStartEffect(obj, cb)
    UISound.play("competition_putin")
    local view = ModelList.BattleModel:GetCurrBattleView()
    local cookie = fun.get_instance(obj, view.go)
    local competitionAni = fun.get_component(cookie, fun.ANIMATOR)
    if competitionAni then
        local count = ModelList.BattleModel:GetCurrModel():GetCardCount()
        competitionAni:Play(count > 1 and "2ka" or "1ka")
    end
    Destroy(cookie, 4)
    LuaTimer:SetDelayFunction(4, function()
        fun.SafeCall(cb)
        ModelList.BattleModel:GetCurrBattleView():SetReadyForPreUseItem(7)
    end, nil, LuaTimer.TimerType.Battle)
end

---展示Quest的入场效果
---@param obj table 实例化的effct OBj
function CompetitionDependentFile.ShowQuestStartEffect(obj, cb)
    UISound.play("racingoilputin1")
    local view = ModelList.BattleModel:GetCurrBattleView()
    local instance = fun.get_instance(obj, view.go)
    local competitionAni = fun.get_component(instance, fun.ANIMATOR)
    local haveBuff = ModelList.CarQuestModel:GetMoreItemBuffTime() > 0

    if haveBuff then
        UISound.play("racingoilputin1")
    else
        UISound.play("racingoilputin2")
    end
    
    if competitionAni and haveBuff then
        local count = ModelList.BattleModel:GetCurrModel():GetCardCount()
        competitionAni:Play(count > 1 and "2ka" or "1ka")
    end
    Destroy(instance, 4)
    
    LuaTimer:SetDelayFunction(4, function()
        fun.SafeCall(cb)
        ModelList.BattleModel:GetCurrBattleView():SetReadyForPreUseItem(7)
    end, nil, LuaTimer.TimerType.Battle)
end

---展示火山活动的战斗入场效果
---@param obj table 实例化的effct OBj
function CompetitionDependentFile.ShowVolcanoStartEffect(obj, cb)
    UISound.play("missionputin")
    local view = ModelList.BattleModel:GetCurrBattleView()
    local instance = fun.get_instance(obj, view.go)
    Destroy(instance, 4)
    LuaTimer:SetDelayFunction(4, function()
        fun.SafeCall(cb)
        ModelList.BattleModel:GetCurrBattleView():SetReadyForPreUseItem(7)
    end, nil, LuaTimer.TimerType.Battle)
end

CompetitionDependentFile[1] = {
    topCompetitionView = "View.CommonView.TopCompetitionView",          --主界面/大厅顶部UI Lau文件
    topPrefabName = "TopCompetitionCookieView",                         --主界面/大厅顶部UI Prefab
    mainAtlasName = "CompetitionCookieAtlas",
    popAtlasName = "CompetitionCookiePopupAtlas",
    readyAtlasName = "CompetitionCookiePopupAtlas",
    bingoCoinName = "CompetitionCookieCoin",                            --杯赛收集道具的ID
    battleStartEffectName = "DailyCompetitionCookiezhandou",            --战斗开始时 Prefab
    showStartEffect = CompetitionDependentFile.ShowCookieStartEffect,   --战斗开始时 Prefab播动画
    readyViewName = "CompetitionCookieReadyView",                       --Loading界面UI Prefab
    readyViewPath = "View.DailyCompetition.CompetitionReadyView",       --Loading界面UI Lau文件
}
CompetitionDependentFile[2] = {
    topCompetitionView = "View.CommonView.TopCompetitionView",          
    topPrefabName = "TopCompetitionCookieView",                         
    mainAtlasName = "CompetitionCookieAtlas",                           
    popAtlasName = "CompetitionCookiePopupAtlas",
    readyAtlasName = "CompetitionCookiePopupAtlas",
    bingoCoinName = "CompetitionCookieCoin",
    battleStartEffectName = "DailyCompetitionCookiezhandou",
    showStartEffect = CompetitionDependentFile.ShowCookieStartEffect,
    readyViewName = "CompetitionCookieReadyView",
    readyViewPath = "View.DailyCompetition.CompetitionReadyView",
}
CompetitionDependentFile[3] = {
    topCompetitionView = "View.CommonView.TopCompetitionView",
    topPrefabName = "TopCompetitionCookieView",
    mainAtlasName = "CompetitionCookieAtlas",
    popAtlasName = "CompetitionCookiePopupAtlas",
    readyAtlasName = "CompetitionCookiePopupAtlas",
    bingoCoinName = "CompetitionCookieCoin",
    battleStartEffectName = "DailyCompetitionCookiezhandou",
    showStartEffect = CompetitionDependentFile.ShowCookieStartEffect,
    readyViewName = "CompetitionCookieReadyView",
    readyViewPath = "View.DailyCompetition.CompetitionReadyView",
}
--赛车活动
CompetitionDependentFile[4] = {
    topCompetitionView = "View.CommonView.TopCompetitionQuestView",
    topPrefabName = "TopCompetitionQuestView",
    mainAtlasName = "CompetitionQuestAtlas",
    popAtlasName = "CompetitionQuestPopupAtlas",
    readyAtlasName = "CompetitionQuestPopupAtlas",
    bingoCoinName = "CompetitionQuestCoin",
    battleStartEffectName = "DailyCompetitionQuestzhandou",
    showStartEffect = CompetitionDependentFile.ShowQuestStartEffect,
    readyViewName = "CompetitionQuestReadyView",
    readyViewPath = "View.DailyCompetition.Quest.CompetitionQuestReadyView",
}
--火山活动
CompetitionDependentFile[5] = {
    battleStartEffectName = "VolcanoDailyCompetitionzhandou",
    showStartEffect = CompetitionDependentFile.ShowVolcanoStartEffect,
}

return CompetitionDependentFile