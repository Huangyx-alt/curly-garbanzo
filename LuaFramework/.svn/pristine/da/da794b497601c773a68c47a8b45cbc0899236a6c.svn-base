---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/2/12 17:50
---

require("View/Bingo/SettleModule/State/BaseSettleState")

SettleDetailState = Clazz(BaseSettleState,"SettleDetailState")
local this = SettleDetailState
function SettleDetailState:New(view)
    local o = {}
    setmetatable(o,{__index = SettleDetailState})
    o.view = view
    return o
end


function SettleDetailState:OnEnter(fsm,prvious,...)
    ModelList.BattleModel:GetCurrBattleView():HideTopLayer()
    this:OpenDetailView(self.view)
end

function SettleDetailState:OpenDetailView(view)
    coroutine.start(function()
        --- 清理卡牌
        local cardMapObj = ModelList.BattleModel:GetCurrBattleView():GetCardMapsObject()
        if cardMapObj and #cardMapObj > 0 then
            for i = 1, #cardMapObj do
                if  fun.is_not_null(cardMapObj[i]) then
                    --- 遍历cardMapObj的子物体，除jackpot特效，其他都销毁
                    for j = cardMapObj[i].transform.childCount,1,-1  do
                        if fun.is_not_null(cardMapObj[i]) and fun.is_not_null(cardMapObj[i].transform) then
                            if cardMapObj[i].transform.childCount> j -1 then
                                local child = cardMapObj[i].transform:GetChild(j-1)
                                if  fun.is_not_null(child)  and not string.find(child.name,"ackpot") then
                                    Destroy(child)
                                    WaitForEndOfFrame()
                                end
                            end
                        else
                            break
                        end
                    end
                else
                    break
                end
            end
        end
        Facade.SendNotification(NotifyName.ShowUI,ViewList.TopConsoleView)
        WaitForEndOfFrame()
        ViewList.SettleDetailView:SkipLoadShow(view)
    end)
end


  
--function SettleDetailState:on_x_update()
--
--end


function SettleDetailState:OnLeave(fsm)

end

function SettleDetailState:FinishOperate(fsm)
    if fsm then
        self:ChangeState(fsm,"RocketWaitDataState")
    end
end