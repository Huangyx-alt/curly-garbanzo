---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2025/2/10 15:11
---
---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2025/2/10 15:11
---
local SGSuperMatchDataCmp = {}
local this = SGSuperMatchDataCmp

function SGSuperMatchDataCmp:Init()
    self:RegEvent()
end

function SGSuperMatchDataCmp:RegEvent()
    if (self.MsgIdList) then
        for k1, v1 in ipairs(self.MsgIdList) do
            if v1.msgid then Message.AddMessage(v1.msgid, v1.func) end
        end
    end
end

function SGSuperMatchDataCmp:UnRegEvent()
    if (self.MsgIdList) then
        for k1, v1 in ipairs(self.MsgIdList) do
            if v1.msgid then Message.RemoveMessage(v1.msgid) end
        end
    end
end

--刮刮乐玩法，收到摇球机数据
function SGSuperMatchDataCmp.ResponeMansionInfo(code, data)
    if code == RET.RET_SUCCESS then
        if not data.gameId or data.gameId == "" then
            --为空重置游戏
            --return
        end
        this.MansionInfo = data
        ---不在战斗中,弹窗
        if not ModelList.BattleModel:IsGameing() then
            ViewList.SGMoneyBuildingMainView = require(
                "View.Bingo.SettleModule.UIView.SmallGame.Normal.SGMoneyBuildingMainView")
        end
    end
end

function SGSuperMatchDataCmp.ResSmashReward(code, data)
    if code == RET.RET_SUCCESS then
        if ViewList.SGSuperMatchMainView then
            ViewList.SGSuperMatchMainView:PlayBangStart()
        end
    else
        if ViewList.SGSuperMatchMainView then
            ViewList.SGSuperMatchMainView:ForceExit()
        end
    end
end

function SGSuperMatchDataCmp:ReqSGInfo(...)
    local gameId = ModelList.BattleModel:GetCurrModel():LoadGameData().gameId
    if gameId then
        Network.SendMessage(MSG_ID.MSG_SUPER_MATCH_SMASH_REWARD, { gameId = gameId }, false, true)
    else
        if ViewList.SGSuperMatchMainView then
            Facade.SendNotification(NotifyName.CloseUI, ViewList.SGSuperMatchMainView)
            ViewList.SGSuperMatchMainView = nil
        end
    end
end

--刮刮乐玩法，入场清除ScratchBallShakerData
function SGSuperMatchDataCmp:ClearData()
    self.MansionInfo = nil
    self:UnRegEvent()
end

function SGSuperMatchDataCmp:SaveScratchBallShakerData(data)
    self.MansionInfo = data
end

--在小火箭界面,需要用到的小游戏数据
function SGSuperMatchDataCmp:GetSmallGameData()
    return nil
end

--在正式结算之后,需要用到的小游戏数据
function SGSuperMatchDataCmp:GetSmallGameData2()
    return this.MansionInfo
end

--获取其他数据的接口
function SGSuperMatchDataCmp:GetExtraSmallGameData(...)
    if ... == 1 then
        return this:IsSettleTriggerSmash()
    elseif ... == 2 then
        return this:IsSmashTriggerInLobby()
    elseif ... == 3 then
        return this:IsSmashRewardInSettleReward()
    end
end

---结算是否触发锤力器
function SGSuperMatchDataCmp:IsSettleTriggerSmash()
    local rewards = ModelList.BattleModel:GetCurrModel():GetSettleExtraInfo("SuperMatchSmash")
    if rewards and rewards.rewardList and rewards.hitLevel and rewards.hitLevel > 0 then
        return true
    end
    return false
end

---锤力器在大厅是否能触发
function SGSuperMatchDataCmp:IsSmashTriggerInLobby()
    local curRate = ModelList.CityModel:GetBetRate()
    local playid = ModelList.CityModel.GetPlayIdByCity()
    local minBet = Csv.GetData("city_play", playid, "supermatch_bet")
    if minBet == 0 then return false end
    return curRate >= minBet and true or false
end

--- 检查结算奖励道具中是否有锤力器道具
function SGSuperMatchDataCmp:IsSmashRewardInSettleReward()
    local settleData = ModelList.BattleModel:GetCurrModel():GetSettleData()
    if settleData then
        this.smashId = nil
        for j = 1, #settleData.reward do
            if settleData.reward[j].id == 37032 or settleData.reward[j].id == 37033 or settleData.reward[j].id == 37034 then
                this.smashId = settleData.reward[j].id
                break
            end
        end
        if this.smashId then
            local index = tostring(this.smashId):sub(-1)
            return tonumber(index)
            --this.smashIcon.sprite = AtlasManager:GetSpriteByName("GameItemAtlas", "ClqJs0" .. index)
            --fun.set_active(this.superMatchSmash, true)
        end
    end
    return 0
end

this.MsgIdList = {
    { msgid = MSG_ID.MSG_SUPER_MATCH_SMASH_REWARD, func = this.ResSmashReward },
}

return SGSuperMatchDataCmp
