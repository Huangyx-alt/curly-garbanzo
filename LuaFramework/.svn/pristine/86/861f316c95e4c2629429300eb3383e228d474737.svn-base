---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 29/7/2024 ÉÏÎç 9:57
---


local BaseOrder = require "PopupOrder/BaseOrder"
local PopupBisonPassPurchaseOrder = Clazz(BaseOrder, "PopupBisonPassPurchaseOrder")
local this = PopupBisonPassPurchaseOrder

function PopupBisonPassPurchaseOrder.Execute(occasion, config, extra)
    this.needBreakPopupOrder = false
    local isNeedPopup = this.IsNeedPopup(config, occasion, extra)
    --undo for test wait delete
    --isNeedPopup = true
    if isNeedPopup then
        local playerInfo =  ModelList.PlayerInfoModel:GetUserInfo()
        this.RefreshPopTime("PopupBisonPassPurchaseOrder" .. playerInfo.uid, config)
        Event.AddListener(NotifyName.GamePlayShortPassView.PopupBisonPassPurchaseOrderFinish, this.Finish, this)
        local params = {}
        params.isActiveByPopup = true
        Facade.SendNotification(NotifyName.GamePlayShortPassView.ShowGamePlayShortPassView, "PassPurchaseView", params)
    else
        this.Finish()
    end
end

function PopupBisonPassPurchaseOrder.Finish()
    log.g("brocast EventName.Event_popup_order_finish PopupBisonPassPurchaseOrderFinish")
    Event.RemoveListener(NotifyName.GamePlayShortPassView.PopupBisonPassPurchaseOrderFinish, this.Finish, this)
    this.NotifyCurrentOrderFinish()
    --Event.Brocast(EventName.Event_popup_order_finish, true)
end

function PopupBisonPassPurchaseOrder.BreakPopupOrder()
    this.needBreakPopupOrder = true
end

function PopupBisonPassPurchaseOrder.IsPreOrderFinish()
    return this.needBreakPopupOrder
end

function PopupBisonPassPurchaseOrder.IsNeedPopup(config, occasion, extra)
    if not extra then
        return false
    end

    if extra.playType ~= 27 then
        return false
    end

    if occasion ~= PopupOrderOccasion.enterHallFromBattle then
        return false
    end

    local playerInfo =  ModelList.PlayerInfoModel:GetUserInfo()
    if not this.IsAllowPop("PopupBisonPassPurchaseOrder" .. playerInfo.uid, config) then
        return false
    end

    local model = ModelList.GameActivityPassModel.GetPassDataComponentById(27)
    if not model then
        return false
    end

    local isPay = model:IsAnyPayment()
    if isPay then
        return false
    end

    return true
end

return this