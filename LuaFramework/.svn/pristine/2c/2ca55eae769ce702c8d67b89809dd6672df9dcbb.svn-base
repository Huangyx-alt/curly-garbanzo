---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/8/17 11:55
---

---  卡牌wish特效

local CardWishEffect = Clazz(ClazzBase,"CardWishEffect")

local this = CardWishEffect

function CardWishEffect:Init(cardView,cotainer)
    this.cardView = cardView
    this.cotainer = cotainer
end

-- 播放格子的 wish 效果
function CardWishEffect:PlayCellWish(cardId, cellIndex, isSelfBingoCell)
    if isSelfBingoCell then
        log.r(string.format("[CardWishEffect] PlayCellWish cardId:%s, cellIndex:%s, self_bingo, return", cardId, cellIndex))
        return
    end
    
    local cell = this.cardView:GetCardCell(cardId, cellIndex)
    local ref_temp = fun.get_component(cell, fun.REFER)
    --local gifEffectCache = nil
    --if ModelList.BattleModel:GetCurrBattleView():IsAuto() then
    --    gifEffectCache = BattleEffectPool:Get("gif_effect",nil)
    --    if gifEffectCache then
    --        fun.set_parent(gifEffectCache, cell, false)
    --        fun.set_gameobject_pos(gifEffectCache,0,0,0,true)
    --        fun.play_animator(gifEffectCache, "efgifwish", true)
    --        LuaTimer:SetDelayFunction(2, function()
    --            if gifEffectCache then
    --                BattleEffectPool:Recycle("gif_effect",gifEffectCache)
    --            end
    --        end,nil,LuaTimer.TimerType.Battle)
    --    end
    --else
    --    local giftAnima = ref_temp:Get("gift")
    --    if giftAnima then
    --        giftAnima:Play("efgifwish")
    --    end
    --end
    
    local tip = ref_temp:Get("Wish")
    fun.set_active(tip, true)
    
    --LuaTimer:SetDelayFunction(0.34, function()
    --    if ref_temp then
    --        for i = 1, 4 do
    --            local number = ref_temp:Get("number" .. i)
    --            if number and fun.is_not_null(number.sprite) then
    --                local order = tonumber(string.sub(number.sprite.name, #number.sprite.name))
    --                if order then
    --                    --this.cardView:SetYellowNumberSprites(number, order)
    --                    this.cardView:SetNumberSpritesOnMirror(number, order)
    --                end
    --            end
    --        end
    --    end
    --end)
end



-- 播放格子的 wish 效果
function CardWishEffect:HideCellWish(cell)
    local ref_temp = fun.get_component(cell, fun.REFER)
    --local gifEffectCache = nil
    --if ModelList.BattleModel:GetCurrBattleView():IsAuto() then
    --    gifEffectCache = BattleEffectPool:Get("gif_effect",nil)
    --    if gifEffectCache and not fun.is_null(gifEffectCache) then
    --        fun.set_parent(gifEffectCache, cell, false)
    --        fun.set_gameobject_pos(gifEffectCache,0,0,0,true)
    --        fun.play_animator(gifEffectCache, "efgifwishover", true)
    --        --table.insert(gifEffectCache,gifEffectCache)
    --        LuaTimer:SetDelayFunction(2, function()
    --            if gifEffectCache then
    --                BattleEffectPool:Recycle("gif_effect",gifEffectCache)
    --            end
    --        end)
    --    end
    --else
    --    local giftAnima = ref_temp:Get("gift")
    --    if giftAnima then
    --        giftAnima:Play("efgifwishover")
    --    end
    --end    
    --if ref_temp then
    --    for i = 1, 4 do
    --        local number = ref_temp:Get("number" .. i)
    --        if number and fun.is_not_null(number.sprite) and fun.is_not_null(number.sprite) then
    --            local order = tonumber(string.sub(number.sprite.name, 10,10))
    --            if order then
    --                this.cardView:RestoreDefaultNumberSprites(number, order)
    --            elseif number.sprite == nil then
    --                log.r("number.sprite.name  nil  ")
    --            else
    --                log.r("number.sprite.name  " .. number.sprite.name)
    --            end
    --        end
    --    end
    --end

    local tip = ref_temp:Get("Wish")
    fun.set_active(tip, false)
end

---单独播放第二组数字的wish
function CardWishEffect:OnlyDoubleNumPlayWish(ref_temp)
    --local ref_temp = fun.get_component(cell, fun.REFER)
    if ref_temp then
        for i = 3, 4 do
            local number = ref_temp:Get("number" .. i)
            if number and fun.is_not_null(number.sprite) and fun.is_not_null(number.sprite) then
                local order = tonumber(string.sub(number.sprite.name, #number.sprite.name))
                if order then
                    --this.cardView:SetYellowNumberSprites(number, order)
                elseif number.sprite == nil then
                    log.r("number.sprite.name  nil  ")
                else
                    --log.r("number.sprite.name  " .. number.sprite.name)
                end
            end
        end
    end
end

return this