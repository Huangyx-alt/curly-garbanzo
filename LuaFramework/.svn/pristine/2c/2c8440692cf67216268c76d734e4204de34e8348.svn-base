---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/10/11 17:25
---

local BaseSkill =  require("View.Bingo.CardModule.Skill.BaseSkill")

local JokerSkill = BaseSkill:New("JokerSkill")
setmetatable(JokerSkill,BaseSkill)
local this = JokerSkill

function JokerSkill:ShowJokerSkill(cardId, cellIndex, powerId)
    self:SaveSkillInfo(cardId,nil)
    local target = self:GetCardPower().cardView:GetCardCell(tonumber(cardId), cellIndex)
    BattleEffectCache:GetSkillPrefabFromCache("cityget", target, nil, 2)
    LuaTimer:SetDelayFunction(0.5, function()
        local targetObj = self:GetCardPower().cardView:GetCardCell(tonumber(cardId), cellIndex)
        BattleEffectCache:GetSkillPrefabFromCache("Citylswjs", targetObj, function(obj)
            self:SaveSkillInfo(cardId,obj)
            local ori_x = math.modf((cellIndex - 1) / 5)
            local ori_y = math.modf((cellIndex - 1) % 5)
            UISound.play("city1_skill")
            self:SameScaleWithCard(obj, cardId)
            fun.set_same_position_with(obj, self:GetCardPower().cardView:GetCardCell(tonumber(cardId), cellIndex))
            LuaTimer:SetDelayFunction(1.8, function()
                local new_x = ori_x + 1
                local new_y = ori_y + 2
                if new_x >= 0 and new_x <= 4 and new_y >= 0 and new_y <= 4 then
                    local new_index = new_x * 5 + new_y + 1
                    self:GetCardPower().cardView:OnClickCardIgnoreJudgeByIndex(cardId, new_index, powerId)
                    self:GetCardPower():ChangeCellState(cardId, new_index, self.CellState.Signed)
                end
            end,nil,LuaTimer.TimerType.Battle)
            LuaTimer:SetDelayFunction(2, function()
                local new_x = ori_x + 0
                local new_y = ori_y + 2
                if new_x >= 0 and new_x <= 4 and new_y >= 0 and new_y <= 4 then
                    local new_index = new_x * 5 + new_y + 1
                    self:GetCardPower().cardView:OnClickCardIgnoreJudgeByIndex(cardId, new_index, powerId)
                    self:GetCardPower():ChangeCellState(cardId, new_index, self.CellState.Signed)
                end
            end,nil,LuaTimer.TimerType.Battle)
            LuaTimer:SetDelayFunction(2.2, function()
                local new_x = ori_x + 1
                local new_y = ori_y + 1
                if new_x >= 0 and new_x <= 4 and new_y >= 0 and new_y <= 4 then
                    local new_index = new_x * 5 + new_y + 1
                    self:GetCardPower().cardView:OnClickCardIgnoreJudgeByIndex(cardId, new_index, powerId)
                    self:GetCardPower():ChangeCellState(cardId, new_index, self.CellState.Signed)
                end
            end,nil,LuaTimer.TimerType.Battle)
            LuaTimer:SetDelayFunction(2.4, function()
                local new_x = ori_x + 0
                local new_y = ori_y + 1
                if new_x >= 0 and new_x <= 4 and new_y >= 0 and new_y <= 4 then
                    local new_index = new_x * 5 + new_y + 1
                    self:GetCardPower().cardView:OnClickCardIgnoreJudgeByIndex(cardId, new_index, powerId)
                    self:GetCardPower():ChangeCellState(cardId, new_index, self.CellState.Signed)
                end
            end,nil,LuaTimer.TimerType.Battle)
            LuaTimer:SetDelayFunction(4.5,function()
                self:RemoveSkillInfo(obj)
                BattleEffectPool:Recycle("Citylswjs",obj)
                --Destroy(obj)
            end,nil,LuaTimer.TimerType.Battle)
        end)
    end,nil,LuaTimer.TimerType.Battle)
end

return this