---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 15610.
--- DateTime: 2023/4/22 21:14
---

local QuickTaskBaseState = require "State/QuickTaskView/QuickTaskBaseState"
local CompetitionEnterState = Clazz(QuickTaskBaseState,"CompetitionEnterState")
function CompetitionEnterState:OnEnter(fsm,previous,...)
    if fsm and self:CheckSkip() then
        return
    end
    --log.r("enter  CompetitionEnterState")
    self.owner = fsm:GetOwner()
    self.fsm = fsm
    self.owner:SetTaskInfo2()
    local first = ModelList.CompetitionModel:IsAnyFirstOpen()
    self.owner:RefreshRemainTime()
    if first  then
        local animName = {"enter","efTopQuickTaskViewienter"}
        ModelList.CompetitionModel.SetPrefsString("competition_last_open")
        log.r("AnimatorPlayHelper  play    "..animName[1])
        AnimatorPlayHelper.Play(self.owner.anima,{animName[1],animName[2]},false,0.1,function()
            fun.set_active(self.owner.content,true,false)
        end,function()
            ModelList.CompetitionModel:CutdownFirstPopup()
            self:PlayOver()

            --CompetitionEnterState:PlayOver()
            --if quickTask and not quickTask.completed and quickTask.oldProgress < quickTask.progress  then
            --    self:DoAnimationObtainableTaskItem()
            --else
            --    self:OnCheckQuickTask2()
            --end
        end)
    else
        fun.set_active(self.owner.content,true,false)
        self:PlayOver()

        --self:OnCheckQuickTask2()
    end
end

function CompetitionEnterState:OnLeave(fsm)
end

function CompetitionEnterState:on_x_update()
    if self.owner.anima then
        if  self.owner.anima:GetCurrentAnimatorStateInfo(0) :IsName("idle1") then
            self:stop_x_update()
            self:PlayOver()
        end
    end
end

function CompetitionEnterState:TweenSliderFinish(fsm)

end


function CompetitionEnterState:PlayOver()
    local isDoubleCollect = ModelList.CompetitionModel:GetDoubleCollectBuffTime() > 0
    if isDoubleCollect then
        self.fsm:ChangeState("CompetitionDoubleEnterState")
    else
        self.fsm:ChangeState("CompetitionExtraRewardState")
    end
    --self.fsm:ChangeState("QuickTaskOriginalState")
end

return CompetitionEnterState