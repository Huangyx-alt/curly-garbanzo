---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/8/31 15:46
---


DoubleCookieExitState = Clazz(BaseFsmState,"DoubleCookieExitState")

function DoubleCookieExitState:OnEnter(fsm,previous,...)
    --log.r("DoubleCookieExitState")
    fsm:GetOwner():PlayExit()
    LuaTimer:SetDelayFunction(0.5,function()
        --Event.Brocast(EventName.Event_popup_activity_double_cookie_finish)
        Facade.SendNotification(NotifyName.HideUI, ViewList.CompetitionPromotedView)
        self:PopupNext()
    end,nil,LuaTimer.TimerType.UI)
end

function DoubleCookieExitState:PopupNext()
    if ModelList.CompetitionModel:IsActivityAvailable()  and
            not ModelList.CompetitionModel:IsShowedCompetitionTip()  then
        Facade.SendNotification(NotifyName.ShowUI, ViewList.CompetitionHelperView,nil,nil,true)
        local uid =ModelList.PlayerInfoModel:GetUid() or ""
        local promoteCount =fun.read_value("competition_show_times_helper"..uid,0)
        fun.save_value("competition_show_times_helper"..uid,promoteCount+1)
    else
        Event.Brocast(EventName.Event_popup_activity_double_cookie_finish)
    end
end

function DoubleCookieExitState:OnLeave(fsm)

end
function DoubleCookieExitState:CloseView()

end