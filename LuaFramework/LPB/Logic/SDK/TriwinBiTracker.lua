---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Endy.
--- DateTime: 2020/5/15 15:19
---
TriwinBiTracker = Clazz()
TriwinBiTracker.apiKey = ""
TriwinBiTracker.URL = "http://192.168.1.200:8010/Public/eventReport"
--框架方法，不应该直接调用   自家产品不需要走独立bi
-- function TriwinBiTracker:do_post(event, data)
--     log.r("Event:", event, "Data:", data)
--     data = data or {}
--     data["version"] = UIUtil.get_client_version()
--     local _event = event
--     local _data = TableToJson(data)
--     local _uid = ModelList.PlayerInfoModel.uid
--     if(_uid ==nil)then
--         return
--     end

--     if (_event == nil or #_event == 0) then
--         log.r("事件名为空")
--         return
--     end

--     if (_data == nil or #_data == 0) then
--         log.r("data为空")
--         return
--     end
--     if (self.apiKey == nil or #self.apiKey == 0) then
--         log.r("data为空")
--         return
--     end
--     local function post_callback(code, txt)
--         log.y("TriwinBiTracker[Http原始响应数据]", txt)

--         if code == 200 then

--         else

--         end
--     end

--     local request = LuaHttpRequest.New(self.URL, "post", post_callback)
--     request:AddHeader("Content-Type", "application/x-www-form-urlencoded")
--     request:AddField("apiKey", self.apiKey)
--     request:AddField("uid", _uid)
--     request:AddField("event", _event)
--     request:AddField("data", _data)
--     request:Do(_event)

-- end

function TriwinBiTracker.create()
    local instance = TriwinBiTracker:new()
    instance:init_key()
    instance.download_list = {}
    return instance
end

function TriwinBiTracker:init_key()
    --[[
    local channel = IAPHelper.get_pay_channel()

    if (channel == PAY_CHANNEL.PAY_CHANNEL_GOOGLE_PLAY) then
        self.apiKey = "1b0d8de219fc2dd24c493eadf20d5baa"
    elseif (channel == PAY_CHANNEL.PAY_CHANNEL_APPLE_STORE) then
        self.apiKey = "a155150020b14bd9d20248834a0721b9"
    elseif (channel == PAY_CHANNEL.PAY_CHANNEL_AMAZON_SOTRE) then
        self.apiKey = "0dc6f37a06d4a337f285e29073ea827f"
    end
    --]]
end

function TriwinBiTracker:day_first_event(event_name, data)
    local key = event_name .. ModelList.PlayerInfoModel.server_date_str
    local value = fun.read_value(key, 0)
    if value == 0 then
        value = 1
        Http.report_event(event_name, data)
        fun.save_value(key, value)
    end
end

function TriwinBiTracker:first_event(event_name)
    local key = event_name
    local value = fun.read_value(key, 0)
    if value == 0 then
        value = 1
        Http.report_event(event_name, {})
        fun.save_value(key, value)
    end
end

function TriwinBiTracker:first_open()
    Http.report_event("app_first_open", {  },function(code,msg,data)
        log.g("report_event"..code.."     "..msg)
    end)
end

function TriwinBiTracker:app_open()
    Http.report_event("app_open", {event = "app_open",version = UIUtil.get_client_version()})
end

function TriwinBiTracker:open_activity(name, tap)
    Http.report_event("event_" .. name .. "_open", { tap = tap })
end

function TriwinBiTracker:finish_activity(name, step)
    Http.report_event("event_" .. name .. "_finish", { step = step })
end

function TriwinBiTracker:open_view(name,sceneName)
    Http.report_event("open_"..name, { scenes = sceneName })
end

function TriwinBiTracker:click_view(name,sceneName)
    Http.report_event("click_"..name, { scenes = sceneName })
end

function TriwinBiTracker:click_view_exit(name,sceneName)
    Http.report_event("click_"..name.."_exit", { scenes = sceneName })
end

function TriwinBiTracker:open_coins_shop()
    Http.report_event("open_coins_shop", { scenes = SceneViewManager.GetCurrentSceneName() })
end
function TriwinBiTracker:open_diamond_shop()
    Http.report_event("open_diamond_shop", { scenes = SceneViewManager.GetCurrentSceneName() })

end
function TriwinBiTracker:open_piggy_bank()

    Http.report_event("open_piggy_bank", { scenes = SceneViewManager.GetCurrentSceneName() })
end

function TriwinBiTracker:open_vip()
    Http.report_event("open_vip", { scenes = SceneViewManager.GetCurrentSceneName() })
end
function TriwinBiTracker:open_vip_benefits()
    Http.report_event("open_vip_benefits", { scenes = SceneViewManager.GetCurrentSceneName() })
end

function TriwinBiTracker:open_Pannel(name)
    Http.report_event("open_" .. name, { scenes = SceneViewManager.GetCurrentSceneName() })
end

function TriwinBiTracker:click_lobby_banner(name,isInActivity,state)
    Http.report_event("click_lobby_banner", { bannerName = name,isInActivity =isInActivity,state = state })
end

function TriwinBiTracker:click_piggy_icon(isInActivity,state)
    Http.report_event("click_piggy_icon", { isInActivity =isInActivity,state = state })
end

function TriwinBiTracker:click_piggy_post(isFinalDay)
    Http.report_event("click_piggy_post", { isFinalDay =isFinalDay})
end

function TriwinBiTracker:enter_lobby()
    Http.report_event("enter_lobby", { roomType = "common" })
end

function TriwinBiTracker:machine_download(id)
    Http.report_event("machine_download", { machineName = id })
    self.download_list[id] = ModelList.PlayerInfoModel.get_cur_client_time()
end
function TriwinBiTracker:machine_download_success(id)
    Http.report_event("machine_download_success", { machineName = id, timeCost = ModelList.PlayerInfoModel.get_cur_client_time() - self.download_list[id] })
end

function TriwinBiTracker:machine_download_failed(id)
    Http.report_event("machine_download_failed", { machineName = id })
end

function TriwinBiTracker:machine_download_cancel(id)
    Http.report_event("machine_download_cancel",{machineName = id})
end

function TriwinBiTracker:enter_machine(id)
    Http.report_event("enter_machine", { roomType = "common", machineName = id })
end
function TriwinBiTracker:auto_spin()
    Http.report_event("auto_spin", { times = 0 })
end

function TriwinBiTracker:trigger_auto_spin(status)
    if status == "on" then
        Http.report_event("auto_spin",{status = status})
    else
        Http.report_event("auto_spin_close",{status = status})
    end

end

function TriwinBiTracker:click_max_bet(playType)
    Http.report_event("click_maxbet", {playType = playType})
end

function TriwinBiTracker:increase_bet(playType, chooseLevel)
    Http.report_event("click_bet_up", {playType = playType, chooseLevel = chooseLevel})
end

function TriwinBiTracker:decrease_bet(playType, chooseLevel)
    Http.report_event("click_bet_down", {playType = playType, chooseLevel = chooseLevel})
end

function TriwinBiTracker:click_card_icon(playerLevel)
    Http.report_event("click_card_icon", {level = playerLevel})
end

function TriwinBiTracker:adView(adType,adPos,all)
    Http.report_event("adView",{adType = adType,adPos = adPos, all = all})
end


function TriwinBiTracker:open_pop_gift(sceneName  , giftId,isAuto)
    Http.report_event("open_pop_gift", { scenes = sceneName  ,{giftid = giftId, auto = isAuto} })
end

function TriwinBiTracker:open_buy_shop(sceneName)
    Http.report_event("open_buy_shop", { scenes = sceneName  })
end

function TriwinBiTracker:open_powerups_shop(sceneName)
    Http.report_event("open_powerups_shop", { scenes = sceneName  })
end

function TriwinBiTracker:purchase_exception(data)
    Http.report_event("purchase_exception", data)
end

function TriwinBiTracker:purchase_click(data)
    Http.report_event("purchase_click", data)
end

function TriwinBiTracker:purchase_cancel(data)
    Http.report_event("purchase_cancel", data)
end

function TriwinBiTracker:purchase_failed(data)
    Http.report_event("purchase_failed", data)
end

function TriwinBiTracker:guide_step(step,data)
    Http.report_event(step, data)
end

function TriwinBiTracker:post_token()
    local deviceToken = UnityEngine.PlayerPrefs.GetString("DeviceToken","editor")
    local uid = ModelList.PlayerInfoModel.GetUid()
    if uid == 0 or deviceToken ==""  or deviceToken == "editor" then
        return
    end
    Http.report_event("fcm_token_init", {token = deviceToken})
end

function TriwinBiTracker:puzzle_open(data)
    Http.report_event("activity_puzzle_open",data)
end

function TriwinBiTracker:food_open(data)
    Http.report_event("activity_food_open",data)
end

function TriwinBiTracker:giftpack_open(data)
    Http.report_event("giftpack_open",data)
end

function TriwinBiTracker:double_window_open(doubleName)
    Http.report_event("double_window_open",{level = ModelList.PlayerInfoModel:GetLevel(),name =doubleName })
end

function TriwinBiTracker:error_report_window()
    Http.report_event("error_report",{level = ModelList.PlayerInfoModel:GetLevel(),uid = ModelList.PlayerInfoModel:GetUid()})
end

function TriwinBiTracker:login_event(eventName)
    Util.RequestIDFA(function (idfa)
        Http.report_event(eventName, {
            uid =ModelList.PlayerInfoModel:GetUid() or "",
            afid = SDK.af_tracker:GetAppFlyerId() or "",
            traceAdId = SDK.af_tracker:GetAppFlyerId() or "",
            idfa = idfa or "",
            version = UIUtil.get_client_version(),
            data = {
                device = UnityEngine.SystemInfo.deviceUniqueIdentifier,
                msg ="";
                msg2="";
            }
        })
    end)
end

function TriwinBiTracker:upload_settle_data(eventName)
    Util.RequestIDFA(function (idfa)
        Http.report_event(eventName, {
            uid =ModelList.PlayerInfoModel:GetUid() or "",
            afid = SDK.af_tracker:GetAppFlyerId() or "",
            idfa = idfa or "",
            version = UIUtil.get_client_version(),
            data = {
                device = UnityEngine.SystemInfo.deviceUniqueIdentifier,
                msg ="";
                msg2="";
            }
        })
    end)
end

function TriwinBiTracker:click_giftpack(itempos)
    local coins = ModelList.ItemModel.get_coin()
    local diamond = ModelList.ItemModel.get_diamond()
    Http.report_event("click_giftpack", { balanceCoin = coins,balanceDiamond =diamond, itempos = itempos })
end

function TriwinBiTracker:click_download_extrapac(packageName)
    Http.report_event("click_download_extrapac", { packageName = packageName})
end

function TriwinBiTracker:extrapac_end(packageName,type)
    Http.report_event("extrapac_end", { packageName = packageName,type = type})
end

function TriwinBiTracker:extrapac_open(packageName)
    Http.report_event("extrapac_open", { packageName = packageName})
end

--通过深度链接进来的事件
function TriwinBiTracker:thought_DeepLinkopen(deeplink,adid,deviceid)
    Http.report_event("deeplinkattribution", { deeplink = deeplink,adid =adid,deviceid=deviceid })
end

 
 
 
 
-- deeplink发放页面展示
function TriwinBiTracker:thought_DeepLinkRewardPush(dpRewardCodeID)
    
    Http.report_event("deeplink_reward_push", {
    dpRewardCodeID=dpRewardCodeID,
    })
end


function TriwinBiTracker:send_ad_message_to_bi(eventName,adType)
    Http.report_event(eventName, { adType = adType})
end

function TriwinBiTracker:send_ad_fail_message_to_bi(eventName,adType)
    Http.report_event(eventName, { adType = adType})
end

function TriwinBiTracker:send_ad_inter_message_to_bi(eventName,adPos)
    Http.report_event(eventName, { adPos = adPos})
end

function TriwinBiTracker:send_change_user_groups(groups)
    Http.report_event("change_user_groups", { groups = groups})
end

function TriwinBiTracker:send_error_log_to_server(msg)
    Http.report_event("client_error_log", { msg = tostring(msg)})
end


function TriwinBiTracker:BI_Event_Tracker(eventName,data)
    Http.report_event(eventName, data)
end