---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by pc.
--- DateTime: 2021/1/7 11:31
---
MultiLanguageManager = {}
local this = MultiLanguageManager
MultiLanguageManager.title_font = nil
MultiLanguageManager.is_open = false
MultiLanguageManager.content_font = nil
MultiLanguageManager.language = "Chinese"
MultiLanguageManager.languageManager = nil
MultiLanguageManager.ResMap = {
    ["Chinese"] = "M20001",
    ["English"] = "M20000",
}
function MultiLanguageManager:Init()
    if self.is_open then
        self:LoadRes()
    end
end

function MultiLanguageManager:LoadRes(callback)
    Cache.load_prefabs("luaprefab_"..self.ResMap[self.language],"Language",
            function(objs)
                local refer = fun.get_component(objs,fun.LANGUAGERESMANAGER)
                self.languageManager = refer
                self:getTitle(refer)
                self:getContent(refer)
                if callback then callback(objs) end
            end)
end
function MultiLanguageManager:getTitle(refer)
    self.title_font = refer.title
    if(self.title_font == nil) then
        log.r("没有找到title字体")
    end
end
function MultiLanguageManager:getContent(refer)
    self.content_font = refer.content

    if(self.content_font == nil) then
        log.r("没有找到Content字体")
    end
end

function MultiLanguageManager:GetTextByName(name_key)
    local data = StaticData.get_language_data(name_key)
    if data == nil then
        log.r("language表中缺少name_key: "..name_key)
    end
    if self.is_open == false then
        self.language = "English"
    end
    local language_key = string.lower(self.language)
    local content = data[language_key]


    return content
end



function MultiLanguageManager:SetLabelText(label,name_key,...)

    local data = StaticData.get_language_data(name_key)
    if data == nil then
        log.r("language表中缺少name_key: "..name_key)
        if(not fun.is_null(label))then 
            label.text = name_key
        end
       
        return 
    end
    if self.is_open == false then
        self.language = "English"
    end
    local language_key = string.lower(self.language)
    local content = data[language_key]

    --if self.language == "English" then
    --    label.text = content
    --    return
    --end
    local size = data[language_key.."size"]
    if size ~= 0 then
        label.fontSize = size
    end
    local font2 = self.content_font
    if data.fontassettype == 1 then
        font2 = self.title_font
    end
    --local mat = UnityEngine.Object.Instantiate(label.materialForRendering)
    --label.font = font2;
    --mat.mainTexture = font2.material.mainTexture;
    --label.fontSharedMaterial = mat;
    if self.languageManager ~= nil  then
        self.languageManager:ChangeFont(label,font2)
    end

    local lenth,args = self:get_args(...)
    if lenth ~= 0 then
        local lines = Split(content,"#")
        if (#lines == (lenth+1) or #lines == lenth) then
            content = ""
            for i, v in pairs(args) do
                content = content..lines[i]..v
            end
            if lines[lenth+1]~= nil then
                content = content..lines[lenth+1]
            end
        else
            log.r(name_key.."参数数量和输入的参数数量不匹配",#lines,lenth)
        end
    end
    label.text = content

end


function MultiLanguageManager:get_args(...)
    local args = {}
    local count = select('#', ...)

    for index = 1, count do
        local tempArg = select(index, ...)
        table.insert(args, index, tempArg)
    end
    return count,args
end

MLM = MultiLanguageManager