---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/10/17 14:20
---

--- 普通单张卡牌 View
local BaseCardView = BaseChildView:New();
local this = BaseCardView;

this.auto_bind_ui_items = {
    "B1",
    "B2",
    "B3",
    "B4",
    "B5",
    "I1",
    "I2",
    "I3",
    "I4",
    "I5",
    "N1",
    "N2",
    "N3",
    "N4",
    "N5",
    "G1",
    "G2",
    "G3",
    "G4",
    "G5",
    "O1",
    "O2",
    "O3",
    "O4",
    "O5",
    "b_letter",
    "reward1",
    "reward2",
    "reward_icon1",
    "rewardPar",
    "PerfectDaub",
    "letter_b",
    "letter_i",
    "letter_n",
    "letter_g",
    "letter_o",
    "icon",
    "ChipsContainer",
    "fooddz",
    "autoFlag",
    "minigameProgress",
    "bg",
    "letter",
    "rewardCard",
    "shengzi1",
    "foodbg1",
    "foodbg2",
    "foodbg3",
    "ef_Bingo_click",
    "gift_clone",
    "flash_clone",
    "CanvasGroup",
    "EffectRoot",
    "tishi_b",
    "tishi_i",
    "tishi_n",
    "tishi_g",
    "tishi_o",
    "BingoGlow",
}

function BaseCardView:New(name)
    local o ={name = name}
    setmetatable(o,self)
    self.__index = self
    return o
end

function BaseCardView:BindObj(obj,parentView)
    self:on_init(obj,parentView)
    if ModelList.BattleModel.GetIsJokerMachine() then
        self:CoroutineLoadJokerSkin()
    end
end


function BaseCardView:GetCardObj()
    return self.go
end

function BaseCardView:CreateBingoInfo()

end

function BaseCardView:ActiveCard(isActive, cardID, isEnter, cardCount,screenCardMaxCount)
    if isEnter then
        if not isActive and fun.is_not_null(self.go) then
            local child = fun.get_child(self.go, 0)
            if fun.is_not_null(child) then
                fun.set_active(child, false)
            end
            return
        end
        --self:SetCardAlpha(cardID> screenCardMaxCount and 0 or 1)
    end
    if cardID < 3 then
        self:NormalActiveCard(isActive, cardID)
    else
        self:ActiveCardOptimize(isActive, cardID)
    end
end

---设置卡牌的CanvasGroup的alpha值
function BaseCardView:SetCardAlpha(alpha)
    if fun.is_not_null(self.CanvasGroup) then
        log.r("SetCardAlpha  "..self.CanvasGroup.gameObject.name.."  "..alpha)
        self.CanvasGroup.alpha = alpha
    end
end

---正常卡牌激活
function BaseCardView:NormalActiveCard(isActive, cardID)
    if self.go and cardID then
        local iconName = ModelList.BattleModel:GetBattleCardRewardIcon(cardID)
        if iconName then
            local image = fun.get_component(self.fooddz, fun.IMAGE)
            if fun.is_not_null(image) then
                Cache.SetImageSprite("SeasonCardOpenPackage", iconName, image)
            end
        end
        fun.set_active(self.go, isActive)
    end
end

---优化卡牌激活
function BaseCardView:ActiveCardOptimize(isActive, cardID)
    --log.r("ActiveCardOptimize    "..cardID)
    local  timeInterval = 0.3
    if ModelList.BattleModel:IsHangUp() then timeInterval = 0.1 end
    coroutine.start(function()
        coroutine.wait(timeInterval * cardID)
        if self and fun.is_not_null(self.go) then
            self:NormalActiveCard(isActive, cardID)
        end
    end)
end

function BaseCardView:GetCell(cellIndex)
    if cellIndex <=5 then
        return self["B"..cellIndex]
    elseif cellIndex <=10 then
        return self["I"..(cellIndex-5)]
    elseif cellIndex <=15 then
        return self["N"..(cellIndex-10)]
    elseif cellIndex <=20 then
        return self["G"..(cellIndex-15)]
    elseif cellIndex <=25 then
        return self["O"..(cellIndex-20)]
    else
        log.r("cell index 有问题 "..cellIndex)
        return nil
    end
end

function BaseCardView:CoroutineLoadJokerSkin()
        coroutine.start(function()
            if self then
                SetJokerSkin3(self.bg, "JokerBattleAtlas", "ClownBcard01")
                SetJokerSkin3(self.foodbg2, "JokerBattleAtlas", "ClownBcard01")
                coroutine.wait(0.5)
                SetJokerSkin3(self.letter, "JokerBattleAtlas", "ClownBcard03")
                SetJokerSkin3(self.rewardCard, "JokerBattleAtlas", "ClownbzbgBg02")
                SetJokerSkin3(self.shengzi1, "JokerBattleAtlas", "ClownbzbgBg03")
                coroutine.wait(0.5)
                SetJokerSkin3(self.foodbg1, "JokerBattleAtlas", "ClownBcard02")
                SetJokerSkin3(self.foodbg3, "JokerBattleAtlas", "ClownBcardGj01")
            end
        end)
end

function BaseCardView:AddCommonEffect(effectType,parent,cellReference)
    if effectType == 1 then -- 添加ef_Bingo_click效果
        if fun.is_not_null(self.ef_Bingo_click) then
            local ef_Bingo_click = fun.get_instance(self.ef_Bingo_click)
            if ef_Bingo_click then
                ef_Bingo_click.name = "ef_Bingo_click"
                fun.set_parent(ef_Bingo_click, parent,true)
                cellReference:Set(ef_Bingo_click,"ef_Bingo_click")
            end
        end
    end
end
return this
