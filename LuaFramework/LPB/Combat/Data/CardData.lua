---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/10/13 14:21
---

local CardData = {}
local this = CardData
CardData.__index = CardData

function CardData:New(orderIndex)
    local card = {
        isBingo = false,                --卡牌是否达成bingo
        isJackpot = false,              -- 卡牌是否达成Jackpot
        cards = {},                     --卡牌信息
        effectType = 0,                 --效果类型
        forward = orderIndex,
        index = orderIndex,             --卡牌Id
        isForbidClickAndPu = false,     -- 是否禁止点击和pu
        ext = {}                        -- 副玩法特有数据(收集物品、达成XX条件等)，数据格式不固定，各个玩法在自己的LogicCard里做管理
    }
    setmetatable(card, { __index = CardData })
    return card
end

function CardData:BeBingo()
    self.isBingo = true
    self.effectType = 1
end

function CardData:AddSingleBingo(cellIndex)
    self.isBingo = true
    self.effectType = 1
end

function CardData:IsBingo()
    --log.r("==============================>>CardData " .. tostring(self.isBingo))
    return self.isBingo
end

function CardData:BeJackpot()
    self.isJackpot = true
    self.effectType = 2
end

function CardData:IsJackpot()
    return self.isJackpot
end

function CardData:SetForbid()
    self.isForbidClickAndPu = true
    Event.Brocast(EventName.Magnifier_Hide_All_Showed_Cell, tonumber(self.index))
end

function CardData:GetForbid()
    return self.isForbidClickAndPu
end

--- 夏威夷玩法额外数据（单bingo格子的使用数据）
---@param order  夏威夷玩法酒杯顺序（红绿黄紫）
---@param num   增加的酒水数量
function CardData:AddHawaiiExtData(cardId, order, num)
    if not self.ext.cardHitCocktailTransform then
        self.ext.cardHitCocktailTransform = {}
    end
    table.insert(self.ext.cardHitCocktailTransform, { cardId = cardId, cocktailNo = order, num = num })
end

--- 添加需要上传到服务器的额外数据
------@param onlyKey string extraData数据中标识数据唯一的key
function CardData:AddExtraUpLoadData(key, extraData, onlyKey)
    self.ext.uploadData = self.ext.uploadData or {}
    self.ext.uploadData[key] = self.ext.uploadData[key] or {}

    local temp = self.ext.uploadData[key]
    if onlyKey and extraData and extraData[onlyKey] then
        if temp[extraData[onlyKey]] then
        else
            temp[extraData[onlyKey]] = extraData
        end
    else
        table.insert(temp, extraData)
    end
end

function CardData:GetExtraUpLoadData(key)
    return (self.ext and self.ext.uploadData) and self.ext.uploadData[key]
end

---
function CardData:GetExtInfo()
    return self.ext
end

function CardData:GetItemCells(itemIds)
    local cellIndexs = {}
    for i = 1, #self.cards do
        if self.cards[i]:HasItem(itemIds) then
            table.insert(cellIndexs, i)
        end
    end
    return cellIndexs
end

function CardData:GetHiddenItemCells(itemId)
    local cellIndexs = {}
    for i = 1, #self.cards do
        if self.cards[i]:HasHiddenItem(itemId) then
            table.insert(cellIndexs, i)
        end
    end
    return cellIndexs
end

function CardData:AddDoubleNumExtData(cardId, cellIndex, num)
    if not self.ext.doubleNumber then
        self.ext.doubleNumber = {}
    end
    table.insert(self.ext.doubleNumber, { cardId = cardId, pos = cellIndex, num = num })
end

return this
