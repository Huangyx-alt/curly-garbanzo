---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/11/15 16:43
---
require("Combat.BattleLogic.Hawaii.HawaiiLogicSwitchCard")
BattleLogic = {}

local this = BattleLogic

function prequire(path)
    local status, lib = pcall(require, path)
    if(status) then return lib end
    return nil
end

function BattleLogic.LoadRequire(gameTypeName,moduleName,fileName)
    log.r("moduleName " .. moduleName)
    this[moduleName] = nil
    local path = "Combat/BattleLogic/" .. gameTypeName .. "/"  .. fileName
    if fileName and not fun.starts(fileName,"Base") and  prequire(path) then
        this[moduleName] = require(path)
        log.r ("require  "..path)
        if not this[moduleName] or type(this.GetLogicModule(moduleName)) ~= "table"  then
            path = "Combat.BattleLogic.Base." .. fileName
            RemoveRequiredByName(path)
            log.EditorLog ("require  "..path)
            this[moduleName] = require(path)
        end
    --elseif   prequire(path..".lua") then
    --    this[moduleName] = require(path..".lua")
    else
        path = "Combat.BattleLogic.Base." .. fileName
        RemoveRequiredByName(path)
        log.r ("require  "..path)
        this[moduleName] = require(path)
    end
end

function BattleLogic:InitBattleLogic ()
    local gameTypeName  = ModelList.BattleModel:GetGameTypeName()
    local gameType  = ModelList.BattleModel:GetGameCityPlayID()
    local moduleData = Csv.GetData("new_game_battle_module",gameType)
    local logicModules = moduleData["logic_module"]
    for i = 1, #logicModules do
        this.LoadRequire(gameTypeName,logicModules[i][1],logicModules[i][2])
    end
end


function BattleLogic.LoadBingoLogic()
    this:InitBattleLogic()
    for k, v in pairs(BattleLogic) do
        if type(v) ~= "function" then
            v:InitLogic()
            if v.Register then
                v:Register()
            end
            log.log(" 增加逻辑功能-- "..v.name)
        end
    end
end

function BattleLogic.GetLogicModule(moduleName)
    return this[moduleName]
end

function BattleLogic.get_backCardStardIndex(moduleName)
    return this[moduleName].back_card_stard_index or 1
end

function BattleLogic.get_currShowCardIndex(moduleName)
    return this[moduleName].curr_show_card_index or 1
end

function BattleLogic.EnableUpdate()
    --local gameType =  ModelList.BattleModel:GetGameType()
    for k, v in pairs(BattleLogic) do
        if type(v) ~= "function" then
            if v.EnableUpdate then
                v:EnableUpdate()
            end
        end
    end
end

--卸载游戏卡牌功能模块
function BattleLogic.UnLoadBingoLogic()
    --local gameType =  ModelList.BattleModel:GetGameType()
    for k, v in pairs(BattleLogic) do
        if type(v) ~= "function" then
            if v.OnDisable then
                v:OnDisable()
            end
            if v.UnRegister then
                v:UnRegister()
            end
            if v.Clear then
                v:Clear()
            end
            log.log("移除逻辑模块-- "..v.name)
            v = nil
        end
    end
end


function BattleLogic.Register()
    for k, v in pairs(BattleLogic) do
        if type(v) ~= "function" then
            if v.Register then
                v.Register()
            end
        end
    end
end

function BattleLogic.UnRegister()
    for k, v in pairs(BattleLogic) do
        if type(v) ~= "function" then
            if v.UnRegister then
                v.UnRegister()
            end
        end
    end
end



return this