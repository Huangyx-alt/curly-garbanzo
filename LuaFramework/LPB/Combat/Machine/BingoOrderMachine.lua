---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/2/25 15:26
---
--- 记录bingoleft顺序

require("Combat/BaseMachine")
BingoOrderMachine = BaseMachine:New("BingoOrderMachine")
local this = BingoOrderMachine
this.robotIds = nil
this.robotsRecordBingoOrder = {}   --  机器人的bingo顺序记录

function BingoOrderMachine:Start(loadData)
    local  robotIds = loadData.robotIds
    this.order = 0
    this.robotsRecordBingoOrder = {}
    this.robotIds = {}
    for i = 1, #robotIds do
        this.robotIds[i] = { robotId = robotIds[i], num = 0 }
    end
end

function BingoOrderMachine:Stop()
end

function BingoOrderMachine:Pause()
end

function BingoOrderMachine:GetRobot()
    local index = math.random(#this.robotIds)
    this.robotIds[index].num = this.robotIds[index].num + 1
    return this.robotIds[index].robotId
end

function BingoOrderMachine:CollectRobotOrder(robotsBingo )
    for i = 1, #robotsBingo do
        this.order = this.order + 1
        --log.g("CollectRobotOrder  产生 1".."  个bingo   ".. "当前为第   "..this.order.."  个")
        local totalNumber = ModelList.BattleModel:GetCurrModel():GetCalledNumber()
        table.insert(this.robotsRecordBingoOrder,{id = robotsBingo[i],order = this.order,calledNo = #totalNumber,cardId = 0})
    end
end

function BingoOrderMachine:GetRobotsOrder( )
    return  TableToJson(this.robotsRecordBingoOrder)
end

function BingoOrderMachine:GetRecordBingoOrder( cardId)
    this.order = this.order + 1
    log.g("CollectRobotOrder  产生 1".."  个bingo   ".. "当前为第   "..this.order.."  个")
    local totalNumber = ModelList.BattleModel:GetCurrModel():GetCalledNumber()
    table.insert(this.robotsRecordBingoOrder,{id = 0,order = this.order,calledNo = #totalNumber,cardId = cardId})
    return this.order
end

function BingoOrderMachine.Register()
    Event.AddListener(EventName.Refresh_Robot_Bingo_Order,this.RefreshRecordBingoOrder)
end

function BingoOrderMachine.UnRegister()
    Event.RemoveListener(EventName.Refresh_Robot_Bingo_Order,this.RefreshRecordBingoOrder)
end

function BingoOrderMachine:RefreshRecordBingoOrder(robotsBingo)
    this:CollectRobotOrder(robotsBingo)
end

return this