---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/4/9 15:21
---
---@class ClimbRankItem : BaseChildView
ClimbRankItem = BaseChildView:New()
local this = ClimbRankItem
this.__index = this
this.auto_bind_ui_items = {
    "text_reward",
    "text_ranked",
    "text_name",
    "img_background",
    "img_selfbackground",
    "image_trophy",
}

function ClimbRankItem:New()
    local o = {}
    setmetatable(o,{__index = this})
    return o
end


function ClimbRankItem.SetDefaultData(item, data,obj,parent,Count)
    item:on_init(obj,parent)
    if data.nickName == "0" then
        item.text_name.text = "YOU"
        item.text_ranked.text = tostring(Count)
        item.text_reward.text = "0"
        fun.set_active(item.img_background.gameObject, false)
        fun.set_active(item.img_selfbackground.gameObject, true)
        item:RefreshMyTrophy(data.tiers)
    else
        local name = Csv.GetData("robot_name",tonumber(data.nickName),"name")
        item.text_name.text = name
        if not Count then
            item.text_ranked.text = data.rank
        else
            item.text_ranked.text = data.rank -1
        end
        item.text_reward.text = fun.formatNum(data.score)
        item:RefreshOtherPlayerTrophy(data.tiers)
    end
end


function ClimbRankItem.RefreshSelfData(item, rank,reward)
    item.text_ranked.text = rank
    item.text_reward.text = fun.formatNum( reward)
end

function ClimbRankItem.RefreshOtherData(item, rank)
    item.text_ranked.text = rank
end

function ClimbRankItem.RefreshOtherPlayerTrophy(item, tiers)
    if tiers and tiers ~= 0 then
        fun.set_active(item.image_trophy , true)
        local trophyName = fun.GetCurrTournamentActivityImg(tiers)

        Cache.load_sprite(AssetList["trophyName"],trophyName,function(sprite)
            if fun.is_not_null(sprite) and fun.is_not_null(item.image_trophy) then
                item.image_trophy.sprite = sprite
            end
        end)
    else
        fun.set_active(item.image_trophy , false)
    end
end

function ClimbRankItem.RefreshMyTrophy(item, tiers)
    if ModelList.TournamentModel:CheckOpenTournament() then
        item:RefreshOtherPlayerTrophy(tiers)
    else
        fun.set_active(item.image_trophy , false)
    end
end

