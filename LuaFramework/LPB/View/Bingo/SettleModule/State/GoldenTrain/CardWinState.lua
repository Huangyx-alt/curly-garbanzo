---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 15/11/2024 下午 2:22
---

local CardWinState = Clazz(BaseFsmState, "CardWinState")
local this = CardWinState

function CardWinState:New()
    local o = {}
    setmetatable(o, { __index = CardWinState })
    return o
end

function CardWinState:InitState()
end

function CardWinState:OnEnter(fsm, previous)
    log.EditorLog("enter  CardWinState")
    this._fsm = fsm
    this._owner = fsm:GetOwner()
    this:CardWinEffect()
end

--- 卡牌胜利
function CardWinState:CardWinEffect()
    local needWin = this._owner:CheckIsLastBingo()
    if needWin then
        LuaTimer:SetDelayFunction(1, function()
            this._owner:PlayCardWinEffect(true)
            UISound.play("goldentrainreward")
            LuaTimer:SetDelayFunction(2.5, function ()
                log.EditorLog("CardWinState  CompleteBingoRound")
                this._owner:PlayCardWinEffect(false)
                this._owner:CompleteBingoRound()
            end, false, LuaTimer.TimerType.Battle)
        end, false, LuaTimer.TimerType.Battle)
    else
        log.EditorLog("CardWinState  CompleteBingoRound")
        this._fsm:GetOwner():CompleteBingoRound()
    end
end

function CardWinState:Finish()

end

function CardWinState:OnLeave(fsm)
    this._fsm = nil
    this._owner = nil
    this._posX = nil
end

function CardWinState:Dispose()
    this:OnLeave(nil)
end

return this
