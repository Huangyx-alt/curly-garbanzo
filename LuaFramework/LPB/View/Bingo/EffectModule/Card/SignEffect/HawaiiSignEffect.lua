---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/10/13 12:10
---

---  夏威夷玩法 格子盖章效果
local BaseSignEffect =  require("View.Bingo.EffectModule.Card.SignEffect.BaseSignEffect")
local HawaiiSignEffect = BaseSignEffect:New("HawaiiSignEffect")
setmetatable(HawaiiSignEffect,BaseSignEffect)
local this = HawaiiSignEffect


function HawaiiSignEffect:RegisterEvent()
    Event.AddListener(EventName.Event_Sign_Cell_Background,self.CellBgEffect,self)
end


function HawaiiSignEffect:UnRegisterEvent()
    Event.RemoveListener(EventName.Event_Sign_Cell_Background,self.CellBgEffect,self)
end


function HawaiiSignEffect:TriggerSingleBingo(cardId,cellIndex)
    --ModelList.BattleModel:GetCurrModel():GetRoundData(cardId)
    Event.Brocast(EventName.Event_Show_Skill_Bingo,cardId,cellIndex)
end

--格子盖章效果
function HawaiiSignEffect:SignCardEffect(cardId,index, cardCell, signType, delay, self_bingo, giftLen)
    signType = signType or 0
    if self:CannotSignCell(cardId,index,signType ) then return end

    delay = delay or 0
    for i = 1, fun.get_child_count(cardCell) do
        fun.set_active(fun.get_child(cardCell,i-1),false)
    end
    local ref_temp = fun.get_component(cardCell, fun.REFER)
    self:HideCellChild(ref_temp, cardId)
    Event.Brocast(EventName.Magnifier_Close_Single_Cell,cardCell,false)
    if  self_bingo then
        self:TriggerSingleBingo(cardId,index)
    end
    Event.Brocast(EventName.Event_Collect_Item_By_Sign,cardId,index)
end


-- 盖章后地板效果
local function GetDiEffectName(drinkType)
    if drinkType == 1 then
        return "bingodiRed"
    elseif drinkType == 2 then
        return "bingodigreen"
    elseif drinkType == 3  then
        return "bingodiYellow"
    else
        return "bingodiPurple"
    end
end

--- 格子底部印章效果
function HawaiiSignEffect:CellBgEffect(drinkType,cardId,cellIndex)
    local diEffect = BattleEffectPool:Get(GetDiEffectName(drinkType))
    fun.set_parent(diEffect,self:GetCardView():GetCardCell(tonumber(cardId), cellIndex),true)
    if self.cardView then
        self.cardView:StorageCellBgEffect(tonumber(cardId) ,cellIndex,diEffect)
    end
end

return this