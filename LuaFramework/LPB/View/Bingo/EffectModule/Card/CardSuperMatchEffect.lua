---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2024/6/20 14:59
---

---  卡牌被机器人叫号特效

local CardSuperMatchEffect = Clazz(ClazzBase,"CardSuperMatchEffect")

local this = CardSuperMatchEffect

function CardSuperMatchEffect:Init(cardView,cotainer)
    this.cardView = cardView
    this.cotainer = cotainer
end

-- 播放格子的 wish 效果
function CardSuperMatchEffect:PlayCellSuperMatch(cell, cardId, cellIndex, ball, number)
    local flyTime = 0.6
    BattleEffectCache:GetPrefabFromPoolOrCache("SuperMatchTrail", ball, 
        function(trail)
            --fun.set_gameobject_scale(trail, 5, 5, 1)
            local startPos = fun.get_gameobject_pos(ball, false)
            local endPos = fun.get_gameobject_pos(cell, false)
            local midPos = fun.calc_new_position_between(startPos, endPos, 0.65, 1, 0)
            local path = {}
            path[1] = midPos
            path[2] = endPos
            Anim.bezier_move(trail, path, flyTime, 0, 1, 2, function()
                BattleEffectCache:GetPrefabFromPoolOrCache("SuperMatchShouGet", cell, function(go)
                    UISound.play("supermatchdaub")
                    LuaTimer:SetDelayFunction(1,function()
                        --盖章
                        -- this.cardView:OnClickCardIgnoreJudgeByIndex(cardId, cellIndex)
                        Event.Brocast(EventName.Normal_Auto_Click, number)
                        --self:GetCardPower():ChangeCellState(cardId, clientPos, self.CellState.Signed)
                        BattleEffectPool:DelayRecycle("SuperMatchShouGet", go, 3)
                    end )            
                end, 2)
            end)

            BattleEffectPool:DelayRecycle("SuperMatchTrail", trail, flyTime + 2)
        end
    )
end

-- 玩家的小卡上播放合作特效
function CardSuperMatchEffect:PlayPlayerSmallCellSuperMatch(cell, cardId, cellIndex, ball, number)
    local flyTime = 0.6
    BattleEffectCache:GetPrefabFromPoolOrCache("SuperMatchTrail", ball, 
        function(trail)
            --fun.set_gameobject_scale(trail, 5, 5, 1)
            local startPos = fun.get_gameobject_pos(ball, false)
            --local endPos = fun.get_gameobject_pos(cell, false)
            local endPos = fun.get_gameobject_pos(cell.transform.parent, false)
            local midPos = fun.calc_new_position_between(startPos, endPos, 0.65, 1, 0)
            local path = {}
            path[1] = midPos
            path[2] = endPos
            Anim.bezier_move(trail, path, flyTime, 0, 1, 2, function()
                BattleEffectCache:GetPrefabFromPoolOrCache("SuperMatchShouGet", cell, function(go)
                    UISound.play("supermatchdaub")
                    fun.set_gameobject_scale(go, 0.5, 0.5, 1)
                    LuaTimer:SetDelayFunction(1, function()
                        --盖章
                        -- this.cardView:OnClickCardIgnoreJudgeByIndex(cardId, cellIndex)
                        Event.Brocast(EventName.Normal_Auto_Click, number)
                        --self:GetCardPower():ChangeCellState(cardId, clientPos, self.CellState.Signed)
                        BattleEffectPool:DelayRecycle("SuperMatchShouGet", go, 3)
                    end )
                end, 2)
            end)

            BattleEffectPool:DelayRecycle("SuperMatchTrail", trail, flyTime + 2)
        end
    )
end

return this