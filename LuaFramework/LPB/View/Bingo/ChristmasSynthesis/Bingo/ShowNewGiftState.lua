---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 26/11/2024 ���� 3:10
---


local ShowNewGiftState = Clazz(BaseFsmState, "ShowNewGiftState")
local this = ShowNewGiftState

function ShowNewGiftState:New()
    local o = {}
    setmetatable(o, { __index = ShowNewGiftState })
    return o
end

function ShowNewGiftState:InitState()
end

function ShowNewGiftState:OnEnter(fsm, previous)
    log.EditorLog(tostring(fsm:GetOwner():GetCardId()) .. " enterstate  " .. "ShowNewGiftState:OnEnter")
    self._fsm = fsm
    self._owner = fsm:GetOwner()
    local data = self._owner:GetNewBingoData().data
    Event.Brocast(EventName.Event_Logic_Collect_Item, self._owner:GetCardId(), data.width, data.height)

    --- δ�������������볡

    local hideCell = self._owner:GetHadExitCells()
    if hideCell then
        local synthesisMapCells = self._owner:GetSynthesisMapCellIndexs()
        local recoverList = {}
        if synthesisMapCells then
            for i = 1, #hideCell do
                if not fun.is_include(hideCell[i], synthesisMapCells) then
                    table.insert(recoverList, hideCell[i])
                    log.r("GetHadExitCells   " .. hideCell[i])
                end
            end
        end
        self._owner:RecoverOldGiftAnima(recoverList)
    end

    self._owner:PlayNewBingoAnima()
end

function ShowNewGiftState:Finish()

end

function ShowNewGiftState:OnLeave(fsm)
    self._fsm = nil
    self._owner = nil
    self._posX = nil
end

function ShowNewGiftState:Dispose()
    self:OnLeave(nil)
end

return this
