---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/5/19 20:14
---


local GiftPackShowState = Clazz(BaseFsmState,"GiftPackShowState")
local this = GiftPackShowState
function GiftPackShowState:New()
    local o = {}
    self.__index = self
    setmetatable(o,self)
    return o
end

local startFly = false

local OnFlyComplete = function()
    if startFly then
        startFly = false

    end
end

function GiftPackShowState:OnEnter(fsm,privious,data)
    this._fsm = fsm
     local posList = {  fsm:GetOwner():GetGiftPos(data.id) }
    local des = Csv.GetData("pop_up",data.id,"item_description")
    --startFly = true
    for k = 1, #des do
        local id = tonumber(des[k][1])
        --- View/GiftPack/State/GiftPackShowState:33: attempt to get length of field 'itemData' (a nil value) currUId 419728
        if data.itemData then
            for i = 1, #data.itemData do
                if id== data.itemData[i].id then
                    Facade.SendNotification(NotifyName.ShopView.FlyRewardEffcts,posList[k],data.itemData[i].id ,function()
                        Event.Brocast(EventName.Event_currency_change)
						if ModelList.SeasonCardModel:IsCardPackage(id) then
							ModelList.SeasonCardModel:OpenCardPackage({bagIds = {id}})
						end
						--OnFlyComplete()
                    end,nil,i-1)
                end
            end
        end
    end
    fsm:GetOwner():ShowDetailGift()
    ---TopConsolePromoteView有个2s的数字跳动动画时间

    LuaTimer:SetDelayFunction(3.5,function()
       -- log.r("ChangeState   GiftPackTransState ")
        --print(this)
        this._fsm:ChangeState("GiftPackTransState")
    end)
end

function GiftPackShowState:OnLeave(fsm)
    self._fsm = nil
end


function GiftPackShowState:TweenSliderFinish(fsm)
    --if fsm then
    --    fsm:GetOwner():QuickTaskFinish()
    --end
end
return GiftPackShowState