---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2022/8/31 10:08
---


--- 双倍美食弹窗界面

DoublePuzzlePromotedView = BaseView:New('DoublePuzzlePromotedView');

require("State.Activity.DoubleIngredirnts.DoubleIngredirntsEnterState")
require("State.Activity.DoublePuzzle.DoublePuzzleExitState")
require("State.Activity.DoubleIngredirnts.DoubleIngredirntsIdleState")

require "View/CommonView/RemainTimeCountDown"

local this = DoublePuzzlePromotedView;
this.viewType = CanvasSortingOrderManager.LayerType.TopConsole

local remainTimeCountDown = RemainTimeCountDown:New()

this.auto_bind_ui_items = {
    "img_rewardIcon",
    "btn_close",
    "btn_continue",
    "anima",
    "text_reward",
    "text_tip",
    "text_endday"
}

function DoublePuzzlePromotedView.Awake(obj)
    --this.update_x_enabled = true
    this:on_init()

end

function DoublePuzzlePromotedView.OnEnable()
    FsmCreator:Create("DoublePuzzlePromotedView",this,{
        DoubleIngredirntsEnterState:New(),
        DoublePuzzleExitState:New(),
        DoubleIngredirntsIdleState:New(),
    })
    this._fsm:StartFsm("DoubleIngredirntsEnterState")

    UISound.play("double_puzzle")

    this.text_reward.text = Csv.GetData("description",8030,"description")
    this.text_tip.text = Csv.GetData("description",8027,"description")

    remainTimeCountDown:StartCountDown(CountDownType.cdt5,
    math.max(0,ModelList.ActivityModel:GetActivityExpireTime(ActivityTypes.doublePuzzle) - os.time()),
    this.text_endday,
function()
    this:on_btn_close_click()
    end)
end

function DoublePuzzlePromotedView:OnDisable()
    remainTimeCountDown:StopCountDown()
end

function DoublePuzzlePromotedView:PlayEnter()
    this.anima:Play("in")
    ModelList.ActivityModel:RemoveLoginOpenActivity(ActivityTypes.doublePuzzle)
    SDK.double_window_open(2)
end

function DoublePuzzlePromotedView:PlayExit()
    this.anima:Play("out")
end

function DoublePuzzlePromotedView:CloseView()
    this._fsm:ChangeState("DoublePuzzleExitState")
end

function DoublePuzzlePromotedView:on_btn_close_click()
    this._fsm:GetCurState():CloseView()
end
function DoublePuzzlePromotedView:on_btn_continue_click()
    this._fsm:GetCurState():CloseView()
end

return this