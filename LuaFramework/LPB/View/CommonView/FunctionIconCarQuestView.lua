---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2024/3/28 17:10
---


local FunctionIconBaseView = require "View/CommonView/FunctionIconBaseView"
require "View/CommonView/RemainTimeCountDown"
local FunctionIconCarQuestView = FunctionIconBaseView:New()
local this = FunctionIconCarQuestView
this.viewType = CanvasSortingOrderManager.LayerType.None

this.auto_bind_ui_items = {
    "btn_task",
    "text_countdown",
    "anima",
}

this.shwoTipTime = -5

function FunctionIconCarQuestView:New()
    local o = {}
    self.__index = self
    o.remainTimeCountDown = RemainTimeCountDown:New()
    setmetatable(o,self)
    return o
end

function FunctionIconCarQuestView:Awake()
    self:on_init()
end

function FunctionIconCarQuestView:OnEnable()
    --self:RegisterEvent()
    self:ShowTime()
end

function FunctionIconCarQuestView:OnDisable()
    self.remainTimeCountDown:StopCountDown()
    --self:RemoveEvent()
end


function FunctionIconCarQuestView:on_btn_task_click()
    local CarQuestConst = require "View/CarQuest/CarQuestConst"
    ViewList.CarQuestMainView:SetEnterMode(CarQuestConst.EnterMode.manualClick)
    ViewList.CarQuestMainView:SetFinishCb(nil)
    Facade.SendNotification(NotifyName.ShowUI, ViewList.CarQuestMainView)
end

function FunctionIconCarQuestView:IsFunctionOpen()
    -- local nowLevel = ModelList.PlayerInfoModel:GetLevel()
    -- local needLevel = Csv.GetLevelOpenByType(10,0)
    -- return nowLevel >= needLevel

    return true
end

--ÊÇ·ñ¹ýÆÚ
function FunctionIconCarQuestView:IsExpired()
    return not (ModelList.CarQuestModel:IsActivityAvailable() or false)
end

function FunctionIconCarQuestView:ShowTime()
    self.remainTimeCountDown:StartCountDown(CountDownType.cdt2,ModelList.CarQuestModel:GetActivityRemainTime(),self.text_countdown)
end

--
--function FunctionIconCarQuestView:RegisterEvent()
--    --Event.AddListener(EventName.Event_BingoPass_UpdateLevel,self.OnCityResourceChange,self)
--end
--
--function FunctionIconCarQuestView:RemoveEvent()
--    --Event.RemoveListener(EventName.Event_BingoPass_UpdateLevel,self.OnCityResourceChange,self)
--end


function FunctionIconCarQuestView:RefreshRedDot()
    RedDotManager:Refresh(RedDotEvent.bingopass_reddot_event)
end

function FunctionIconCarQuestView:OnCityResourceChange()
    log.w("FunctionIconCarQuestView =>OnCityResourceChange")

    self:RefreshRedDot()
end




return this