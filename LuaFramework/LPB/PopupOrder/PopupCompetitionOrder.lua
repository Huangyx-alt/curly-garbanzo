---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2023/4/3 17:20
---
--- 杯赛弹窗
local BaseOrder = require "PopupOrder/BaseOrder"
local PopupOrder = Clazz(BaseOrder,"")

function PopupOrder.Execute(occasion)
    if occasion ~= PopupOrderOccasion.changeCity and
            (ModelList.CompetitionModel:IsActivityAvailable(ActivityTypes.quickTask)  )then
        Event.AddListener(EventName.Event_popup_competition_finish,PopupOrder.Finish)
        --Event.Brocast(EventName.Event_show_competition_task)
        Event.Brocast(EventName.Event_competition_show_popup)
        --if  fun.read_value("competition_open_gift") ~= 1 then
        --    Facade.SendNotification(NotifyName.ShowUI,ViewList.CompetitionCookiePackView)
        --    fun.save_value("competition_open_gift",1)
        --end
    elseif ModelList.CompetitionModel:IsUnAvailableAndHasReward() then
        Event.AddListener(EventName.Event_popup_competition_finish,PopupOrder.Finish)
        Facade.SendNotification(NotifyName.ShowUI,ViewList.CompetitionRewardView,nil,false,true)
    --elseif ModelList.CompetitionModel:IsUnAvailableAndHasRank() then
    --    Event.AddListener(EventName.Event_popup_competition_finish,PopupOrder.Finish)
    --    Facade.SendNotification(NotifyName.ShowUI,ViewList.CompetitionCookieRank,nil,false,true)

    else
        PopupOrder.Finish()
    end
end

function PopupOrder.Finish()
    Event.RemoveListener(EventName.Event_popup_competition_finish,PopupOrder.Finish)
    ModelList.CompetitionModel:SaveOldProgress()
    log.g("brocast  EventName.Event_popup_order_finish  PopupCompetitionOrder")
    Event.Brocast(EventName.Event_popup_order_finish,true)
end

return PopupOrder
