---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by PC.
--- DateTime: 2024/1/8 10:37
---


local BaseOrder = require "PopupOrder/BaseOrder"
local PopupWinZoneCheckOrder = Clazz(BaseOrder, "PopupWinZoneCheckOrder")
local this = PopupWinZoneCheckOrder

function PopupWinZoneCheckOrder.Execute(occasion, order)
    local hasReward =  ModelList.WinZoneModel:HasRewardAndCannotRelive()
    if hasReward then
        this.RegisterReqSettle()
        ModelList.WinZoneModel:C2S_VictoryBeatsReward()
    else
        this.Finish()
    end
end

--- 有结算奖励，监听结算奖励领取完成事件
function PopupWinZoneCheckOrder.RegisterReqSettle()
    Event.AddListener(EventName.Event_WinZone_Popup_Res_SettleReward, this.OnResSettleReward, this)
end

function PopupWinZoneCheckOrder:OnResSettleReward(code,data)
    if code == RET.RET_SUCCESS then
        ModelList.WinZoneModel:DisplayReward(data.reward, this.OnCloseReward)
    else
        this.Finish()
    end
end

--- 关闭结算奖励界面
function PopupWinZoneCheckOrder.OnCloseReward()
    this.Finish()
end


function PopupWinZoneCheckOrder.Finish()
    log.g("brocast EventName.Event_popup_order_finish PopupWinZoneCheckOrder")
    Event.RemoveListener(EventName.Event_WinZone_Popup_Res_SettleReward, this.OnResSettleReward, this)
    this.NotifyCurrentOrderFinish()
    --Event.Brocast(EventName.Event_popup_order_finish, true)
end

return this